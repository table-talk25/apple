"use strict";(self.webpackChunktable_talk_client=self.webpackChunktable_talk_client||[]).push([[712],{1666:(e,a,o)=>{o.d(a,{A:()=>N});var t=o(45),s=o(2555),n=o(8139),l=o.n(n),i=o(5043),r=o(7852),c=o(1068);const d=i.createContext(null);d.displayName="InputGroupContext";const u=d;var m=o(579);const p=["className","bsPrefix","as"],g=i.forwardRef((e,a)=>{let{className:o,bsPrefix:n,as:i="span"}=e,c=(0,t.A)(e,p);return n=(0,r.oU)(n,"input-group-text"),(0,m.jsx)(i,(0,s.A)({ref:a,className:l()(o,n)},c))});g.displayName="InputGroupText";const h=g,_=["bsPrefix","size","hasValidation","className","as"],A=i.forwardRef((e,a)=>{let{bsPrefix:o,size:n,hasValidation:c,className:d,as:p="div"}=e,g=(0,t.A)(e,_);o=(0,r.oU)(o,"input-group");const h=(0,i.useMemo)(()=>({}),[]);return(0,m.jsx)(u.Provider,{value:h,children:(0,m.jsx)(p,(0,s.A)((0,s.A)({ref:a},g),{},{className:l()(d,o,n&&"".concat(o,"-").concat(n),c&&"has-validation")}))})});A.displayName="InputGroup";const N=Object.assign(A,{Text:h,Radio:e=>(0,m.jsx)(h,{children:(0,m.jsx)(c.A,(0,s.A)({type:"radio"},e))}),Checkbox:e=>(0,m.jsx)(h,{children:(0,m.jsx)(c.A,(0,s.A)({type:"checkbox"},e))})})},7352:(e,a,o)=>{o.d(a,{A:()=>i});o(5043);var t=o(3216),s=o(184);const n="BackButton_backButton__hBNQM";var l=o(579);const i=e=>{let{className:a=""}=e;const o=(0,t.Zp)();return(0,l.jsxs)("button",{onClick:()=>{o(-1)},className:"".concat(n," ").concat(a),children:[(0,l.jsx)(s.QVr,{style:{marginRight:8}}),"Torna indietro"]})}},8712:(e,a,o)=>{o.r(a),o.d(a,{default:()=>k});var t=o(2555),s=o(5043),n=o(3216),l=o(5475),i=o(1719),r=o(8298),c=o(1666),d=o(4282),u=o(4117),m=o(5016),p=o(1698),g=o(184),h=o(8577),_=o(5403);const A=(0,_.F3)("SignInWithApple",{web:()=>o.e(292).then(o.bind(o,292)).then(e=>new e.SignInWithAppleWeb)});var N=o(7102);const x=async e=>{try{var a,o;console.log("Tentativo di login con Apple...");const t=await N.default.post("/auth/apple",{identityToken:e.identityToken,authorizationCode:e.authorizationCode,user:{email:e.email,name:(null===(a=e.fullName)||void 0===a?void 0:a.givenName)+" "+(null===(o=e.fullName)||void 0===o?void 0:o.familyName)}});if(t.data.success)return localStorage.setItem("token",t.data.token),localStorage.setItem("user",JSON.stringify(t.data.user)),console.log("Login Apple completato con successo"),{success:!0,user:t.data.user,token:t.data.token}}catch(n){var t,s;throw console.error("Errore durante il login Apple:",n),new Error((null===(t=n.response)||void 0===t||null===(s=t.data)||void 0===s?void 0:s.message)||"Errore durante il login con Apple")}},v="SocialLoginButtons_socialLoginContainer__ykZyJ",f="SocialLoginButtons_divider__If-bh",L="SocialLoginButtons_buttonsContainer__BYwAv",b="SocialLoginButtons_socialButton__TN0Uq",E="SocialLoginButtons_appleButton__0pxeX",P="SocialLoginButtons_appleIcon__Y5cre",j="SocialLoginButtons_spinner__4KrvF";var R=o(579);const C=e=>{let{onSuccess:a,onError:o,disabled:t=!1}=e;console.log("\ud83d\udd25\ud83d\udd25\ud83d\udd25 SOCIAL LOGIN BUTTONS LOADED \ud83d\udd25\ud83d\udd25\ud83d\udd25");const{t:n}=(0,u.Bd)(),[l,i]=(0,s.useState)(!1),[r,c]=(0,s.useState)(null);return(0,R.jsxs)("div",{className:v,children:[(0,R.jsx)("div",{className:f,children:(0,R.jsx)("span",{children:n("auth.orContinueWith")})}),(0,R.jsx)("div",{className:L,children:"ios"===_.Capacitor.getPlatform()&&(0,R.jsx)("button",{type:"button",className:"".concat(b," ").concat(E),onClick:async()=>{if(!l&&!t){i(!0),c("apple");try{const e={clientId:{NODE_ENV:"production",PUBLIC_URL:".",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_API_URL:"https://tabletalk-app-backend.onrender.com/api",REACT_APP_SENTRY_DSN:"https://7f16b90e2f02c8e0ace6775aded4fb50@o4509861508546560.ingest.de.sentry.io/4509861532532816",REACT_APP_SENTRY_ENVIRONMENT:"development",REACT_APP_ENABLE_ERROR_MONITORING:"true"}.REACT_APP_APPLE_CLIENT_ID||"io.tabletalk.app",redirectURI:{NODE_ENV:"production",PUBLIC_URL:".",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_API_URL:"https://tabletalk-app-backend.onrender.com/api",REACT_APP_SENTRY_DSN:"https://7f16b90e2f02c8e0ace6775aded4fb50@o4509861508546560.ingest.de.sentry.io/4509861532532816",REACT_APP_SENTRY_ENVIRONMENT:"development",REACT_APP_ENABLE_ERROR_MONITORING:"true"}.REACT_APP_APPLE_REDIRECT_URI||"https://tabletalk.app/auth/apple/callback",scopes:"email name",state:"12345",nonce:"nonce"},o=await A.authorize(e),t={identityToken:o.response.identityToken,authorizationCode:o.response.authorizationCode,email:o.response.email,fullName:{givenName:o.response.givenName,familyName:o.response.familyName}},s=await x(t);s.success&&a&&a(s)}catch(e){console.error("Errore login Apple:",e),o&&o(e.message||"Errore durante il login con Apple")}finally{i(!1),c(null)}}},disabled:l||t,children:l&&"apple"===r?(0,R.jsx)("div",{className:j}):(0,R.jsxs)(R.Fragment,{children:[(0,R.jsx)("svg",{className:P,viewBox:"0 0 24 24",children:(0,R.jsx)("path",{d:"M18.71 19.5c-.83 1.24-1.71 2.45-3.05 2.47-1.34.03-1.77-.79-3.29-.79-1.53 0-2 .77-3.27.82-1.31.05-2.3-1.32-3.14-2.53C4.25 17 2.94 12.45 4.7 9.39c.87-1.52 2.43-2.48 4.12-2.51 1.28-.02 2.5.87 3.29.87.78 0 2.26-1.07 3.81-.91.65.03 2.47.26 3.64 1.98-.09.06-2.17 1.28-2.15 3.81.03 3.02 2.65 4.03 2.68 4.04-.03.07-.42 1.44-1.38 2.83M13 3.5c.73-.83 1.94-1.46 2.94-1.5.13 1.17-.34 2.35-1.04 3.19-.69.85-1.83 1.51-2.95 1.42-.15-1.15.41-2.35 1.05-3.11z"})}),(0,R.jsx)("span",{children:n("auth.continueWithApple")})]})})})]})},T={page:"LoginPage_page__gNswX",card:"LoginPage_card__tUqje",logoContainer:"LoginPage_logoContainer__xxvZe",logoLink:"LoginPage_logoLink__TtMsm",title:"LoginPage_title__pNfRL",formLabel:"LoginPage_formLabel__EQWZe",formInput:"LoginPage_formInput__nTa2F",passwordToggle:"LoginPage_passwordToggle__GXH9D",inputGroup:"LoginPage_inputGroup__Wuu-c",passwordRequirements:"LoginPage_passwordRequirements__HfiWD",termsContainer:"LoginPage_termsContainer__eHWtv",termsLabel:"LoginPage_termsLabel__nhQ36",submitButton:"LoginPage_submitButton__xW8h9",bottomLink:"LoginPage_bottomLink__c8BRY"};var S=o(7352);const k=()=>{var e;console.log("\ud83d\udd25\ud83d\udd25\ud83d\udd25 LOGIN PAGE LOADED \ud83d\udd25\ud83d\udd25\ud83d\udd25");const{t:a}=(0,u.Bd)(),o=((0,n.Zp)(),(0,n.zy)()),{login:_,isAuthenticated:A}=(0,m.A)(),{redirectAfterAuth:N,savedPath:x}=(()=>{var e,a;const o=(0,n.zy)(),t=(0,n.Zp)(),s=function(){var e,a;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"/meals";const s=null===(e=o.state)||void 0===e||null===(a=e.from)||void 0===a?void 0:a.pathname;return s&&"/login"!==s&&"/register"!==s?(console.log("[useRedirectAfterAuth] Redirect intelligente verso: ".concat(s)),s):(console.log("[useRedirectAfterAuth] Fallback verso: ".concat(t)),t)};return{getRedirectPath:s,redirectAfterAuth:function(){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const a=s(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"/meals");requestAnimationFrame(()=>{t(a,{replace:e}),console.log("[useRedirectAfterAuth] Redirect completato verso: ".concat(a))})},clearRedirectPath:()=>{t(o.pathname,{replace:!0,state:{}})},savedPath:null===(e=o.state)||void 0===e||null===(a=e.from)||void 0===a?void 0:a.pathname}})(),v=new URLSearchParams(o.search),f=v.get("reason"),[L,b]=(v.get("next"),(0,s.useState)({email:"",password:""})),[E,P]=(0,s.useState)(!1),[j,k]=(0,s.useState)(""),[y,I]=(0,s.useState)(!1),[w,O]=(0,s.useState)(!1);(0,s.useEffect)(()=>{(async()=>{try{const e=await(0,p.ml)(p.xo.LAST_LOGIN_EMAIL,"");e&&(b(a=>(0,t.A)((0,t.A)({},a),{},{email:e})),P(!0))}catch(e){}})()},[]),(0,s.useEffect)(()=>{A&&N("/meals")},[A,N]);const B=e=>{const{name:a,value:o}=e.target;console.log("\ud83d\udd25 Form field changed:",a,"password"===o?"***":o),b((0,t.A)((0,t.A)({},L),{},{[a]:o}))};return(0,R.jsxs)("div",{className:T.page,children:[(0,R.jsx)("div",{style:{padding:"12px 16px"},children:(0,R.jsx)(S.A,{})}),(0,R.jsxs)("div",{className:T.card,children:[(0,R.jsx)("div",{className:T.logoContainer,children:(0,R.jsx)(l.N_,{to:"/",className:T.logoLink,children:(0,R.jsx)(h.A,{})})}),(0,R.jsx)("h2",{className:T.title,children:a("auth.loginToTableTalk")}),"session_expired"===f&&(0,R.jsxs)(i.A,{variant:"warning",className:"mb-3",children:[(0,R.jsx)("strong",{children:a("auth.sessionExpired")||"Sessione scaduta"}),(0,R.jsx)("div",{children:a("auth.sessionExpiredMessage")||"Per favore accedi nuovamente per continuare."})]}),x&&"/login"!==x&&(0,R.jsx)(i.A,{variant:"info",className:"mb-3",children:(0,R.jsxs)("small",{children:[(0,R.jsx)("strong",{children:"\ud83d\udca1 Dopo il login verrai reindirizzato a:"}),(0,R.jsx)("br",{}),"/meals"===x?"\ud83c\udfe0 Pagina principale":x.includes("/meals/")?"\ud83c\udf7d\ufe0f Dettaglio pasto":"/map"===x?"\ud83d\uddfa\ufe0f Mappa":"/impostazioni/profilo"===x?"\ud83d\udc64 Profilo":"/my-meals"===x?"\ud83d\udccb I miei pasti":"/chat/"===x?"\ud83d\udcac Chat":x]})}),(null===(e=o.state)||void 0===e?void 0:e.message)&&(0,R.jsx)(i.A,{variant:"success",children:o.state.message}),j&&(0,R.jsx)(i.A,{variant:"danger",children:j}),(0,R.jsxs)(r.A,{onSubmit:e=>{console.log("Button clicked - before normal login call"),(async e=>{console.log("\ud83d\udd25 Normal login started"),e.preventDefault(),k(""),I(!0);try{console.log("\ud83d\udd25 Calling login with formData:",{email:L.email,password:"***"}),await _(L),console.log("\ud83d\udd25 Login successful");try{E?(console.log("\ud83d\udd25 Saving email preference"),await(0,p.zr)(p.xo.LAST_LOGIN_EMAIL,L.email)):(console.log("\ud83d\udd25 Removing email preference"),await(0,p.ov)(p.xo.LAST_LOGIN_EMAIL))}catch(o){}console.log("\ud83d\udd25 Redirecting after auth"),N("/meals")}catch(t){console.error("\ud83d\udd25 Normal login error:",t),console.error("Errore durante il login:",t),k(t.message||a("auth.loginError"))}finally{console.log("\ud83d\udd25 Normal login finished"),I(!1)}})(e)},autoComplete:"on",children:[(0,R.jsxs)(r.A.Group,{className:"mb-3",children:[(0,R.jsx)(r.A.Label,{className:T.formLabel,children:a("auth.email")}),(0,R.jsx)(r.A.Control,{className:T.formInput,type:"email",name:"email",value:L.email,onChange:B,placeholder:a("auth.emailPlaceholder"),autoComplete:"username",inputMode:"email",autoCapitalize:"none",autoCorrect:"off",spellCheck:!1,required:!0})]}),(0,R.jsx)(r.A.Group,{className:"mb-3",children:(0,R.jsx)(r.A.Check,{type:"checkbox",id:"remember-email",label:a("auth.rememberEmail")||"Ricorda email",checked:E,onChange:e=>P(e.target.checked)})}),(0,R.jsxs)(r.A.Group,{className:"mb-3",children:[(0,R.jsx)(r.A.Label,{className:T.formLabel,children:a("auth.password")}),(0,R.jsxs)(c.A,{className:T.inputGroup,children:[(0,R.jsx)(r.A.Control,{className:T.formInput,type:w?"text":"password",name:"password",value:L.password,onChange:B,placeholder:a("auth.passwordPlaceholder"),autoComplete:"current-password",required:!0}),(0,R.jsx)(c.A.Text,{onClick:()=>O(!w),className:T.passwordToggle,children:w?(0,R.jsx)(g.mx3,{}):(0,R.jsx)(g.Ny1,{})})]})]}),(0,R.jsx)(d.A,{type:"submit",className:T.submitButton,disabled:y,children:a(y?"auth.loggingIn":"auth.login")})]}),(0,R.jsx)("div",{className:"mt-4 text-center",children:(0,R.jsxs)("p",{className:"text-muted",children:[a("auth.alreadyHaveAccount")||"Non hai ancora un account?"," ",(0,R.jsx)(l.N_,{to:"/register",className:"text-primary fw-bold",style:{textDecoration:"none"},children:a("auth.register")||"Registrati ora"})]})}),(0,R.jsx)(C,{onSuccess:e=>{console.log("Login social completato:",e),N("/meals")},onError:e=>{k(e)},disabled:y}),(0,R.jsxs)("div",{className:T.links,children:[(0,R.jsx)(l.N_,{to:"/forgot-password",className:T.link,children:a("auth.forgotPassword")}),(0,R.jsx)(l.N_,{to:"/register",className:T.link,children:a("auth.alreadyHaveAccount")})]})]})]})}}}]);
//# sourceMappingURL=712.f2818996.chunk.js.map