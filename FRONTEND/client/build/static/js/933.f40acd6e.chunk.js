"use strict";(self.webpackChunktable_talk_client=self.webpackChunktable_talk_client||[]).push([[933],{2619:(e,a,s)=>{s.d(a,{A:()=>S});s(5043);var l=s(5475),r=s(4117),i=s(184),t=s(5950),n=s(5016),c=s(4935);const o="EditMealButton_editButton__abQ9t";var d=s(579);const m=e=>{let{mealId:a}=e;return(0,d.jsx)(l.N_,{to:"/meals/edit/".concat(a),className:o,children:"Modifica TableTalk\xae"})};var u=s(6229);const _="MealCard_card__ZMpL4",h="MealCard_cardLink__NwoDy",x="MealCard_cardImageWrapper__o3OYh",p="MealCard_cardImageWrapperCompact__NsCVO",j="MealCard_cardImage__NfTS+",g="MealCard_cardImageType__mS24Y",f="MealCard_mealModeBadge__iRhot",b="MealCard_mealModeIcon__1sUXr",P="MealCard_mealModeText__iijFz",v="MealCard_cardTitle__IzHzc",N="MealCard_cardContent__xy66r",A="MealCard_cardDetail__++Z1c",C="MealCard_hostAvatar__SOgSA",I="MealCard_locationIcon__YwiGH",k="MealCard_locationText__4mI9I",M="MealCard_cardDescription__Meeix",y="MealCard_cardActions__apnlz",T="MealCard_actionButtons__m5ryk",B="MealCard_hostLink__HuRU-",S=e=>{var a;let{meal:s,onLeaveSuccess:o,compact:S=!1}=e;const{t:w}=(0,r.Bd)(),{user:U}=(0,n.A)(),{getMealTypeText:L,getMealModeText:D}=(0,c.j)();if(!s||!s.host)return console.error("MealCard ha ricevuto dati incompleti: ",s),null;const H=U&&U.id===s.host._id,E=U&&s.participants&&s.participants.some(e=>e._id===U.id),R=(0,t.xW)(s.imageUrl),q=(0,t.DP)(s.host.profileImage);console.log("\ud83d\udc64 [MealCard] Host ID:",s.host._id||s.host.id),console.log("\ud83d\udc64 [MealCard] Host object:",s.host);const F=s.description&&s.description.length>80?s.description.substring(0,80)+"...":s.description,z=new Date(new Date(s.date).getTime()+6e4*(s.duration||0)),O="completed"===s.status||"cancelled"===s.status||new Date>z;return(0,d.jsxs)("div",{className:_,children:[(0,d.jsxs)(l.N_,{to:"/meals/".concat(s._id),className:h,children:[(0,d.jsxs)("div",{className:S?p:x,children:[(0,d.jsx)("img",{src:R,alt:s.title,className:j}),(0,d.jsx)("div",{className:g,style:{backgroundColor:(0,t.hd)(s.type)},children:L(s.type)}),(0,d.jsxs)("div",{className:f,style:{backgroundColor:(0,t.wI)(s.mealType)},children:[(0,d.jsx)("span",{className:b,children:(0,t.Iy)(s.mealType)}),(0,d.jsx)("span",{className:P,children:D(s.mealType)})]})]}),(0,d.jsxs)("div",{className:N,children:[(0,d.jsx)("h3",{className:v,children:s.title}),(0,d.jsxs)("div",{className:A,children:[(0,d.jsx)(i.gqt,{}),(0,d.jsx)("span",{children:s.language})]}),(0,d.jsx)(l.N_,{to:"/public-profile/".concat(s.host._id||s.host.id),className:B,children:(0,d.jsxs)("div",{className:A,children:[(0,d.jsx)("img",{src:q,alt:s.host.nickname,className:C}),(0,d.jsxs)("span",{children:[w("meals.card.organizedBy")," ",(0,d.jsx)("strong",{children:s.host.nickname})]})]})}),(0,d.jsxs)("div",{className:A,children:[(0,d.jsx)(i.bfZ,{}),(0,d.jsx)("span",{children:(0,t.Yq)(s.date)})]}),!S&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)("div",{className:A,children:[(0,d.jsx)(i.w_X,{}),(0,d.jsxs)("span",{children:[w("meals.card.duration"),": ",s.duration," ",w("meals.card.minutes")]})]}),(0,d.jsxs)("div",{className:A,children:[(0,d.jsx)(i.w_X,{}),(0,d.jsxs)("span",{children:[w("meals.card.end"),": ",(0,t.Yq)(new Date(new Date(s.date).getTime()+6e4*s.duration),"HH:mm")]})]})]}),"physical"===s.mealType&&s.location&&(0,d.jsxs)("div",{className:A,children:[(0,d.jsx)("span",{className:I,children:"\ud83d\udccd"}),(0,d.jsx)("span",{className:k,children:s.location})]}),(0,d.jsx)("p",{className:M,children:F})]})]}),(0,d.jsxs)("div",{className:y,children:[(0,d.jsxs)("div",{className:A,children:[(0,d.jsx)(i.YXz,{}),(0,d.jsxs)("span",{children:[(null===(a=s.participants)||void 0===a?void 0:a.length)||0," / ",s.maxParticipants," ",w("meals.card.participants")]})]}),(0,d.jsxs)("div",{className:T,children:[!S&&H&&!O&&(0,d.jsx)(m,{mealId:s._id}),E&&!H&&!O&&(0,d.jsx)(u.A,{mealId:s._id,onSuccess:o})]})]})]})}},4935:(e,a,s)=>{s.d(a,{j:()=>i});var l=s(4117),r=s(5950);const i=()=>{const{t:e}=(0,l.Bd)(),a=a=>{const s="meals.mealTypes.".concat(a);return e(s,a)},s=a=>{const s="meals.mealModes.".concat(a);return e(s,a)};return{getMealTypeText:a,getMealModeText:s,getMealStatusText:a=>{const s="meals.mealStatus.".concat(a);return e(s,a)},getMealTypeOptions:()=>[{value:r.q_.BREAKFAST,label:a(r.q_.BREAKFAST)},{value:r.q_.LUNCH,label:a(r.q_.LUNCH)},{value:r.q_.DINNER,label:a(r.q_.DINNER)},{value:r.q_.APERITIF,label:a(r.q_.APERITIF)}],getMealModeOptions:()=>[{value:r.x6.VIRTUAL,label:s(r.x6.VIRTUAL)},{value:r.x6.PHYSICAL,label:s(r.x6.PHYSICAL)}]}}},6229:(e,a,s)=>{s.d(a,{A:()=>n});s(5043);var l=s(9926),r=s(4282),i=s(7417),t=s(579);const n=e=>{let{mealId:a,onSuccess:s}=e;const{leaveMeal:n,loading:c}=(0,l.w)();return(0,t.jsx)(r.A,{variant:"outline-danger",className:"w-100",onClick:async()=>{if(window.confirm("Sei sicuro di voler abbandonare questo TableTalk\xae?"))try{const e=await n(a);s&&s(e)}catch(e){console.error("Fallimento leaveMeal nel componente:",e)}},disabled:c,children:c?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(i.A,{as:"span",animation:"border",size:"sm"}),(0,t.jsx)("span",{children:" Uscita in corso..."})]}):"Abbandona il TableTalk\xae"})}},8541:(e,a,s)=>{s.r(a),s.d(a,{default:()=>E});var l=s(5043),r=s(3216),i=s(5475),t=s(4117),n=s(5016),c=s(7469);const o={profilePageBackground:"PublicProfilePage_profilePageBackground__qFORI",profileHeader:"PublicProfilePage_profileHeader__VK2Ce",profileAvatar:"PublicProfilePage_profileAvatar__g-uQl",headerInfo:"PublicProfilePage_headerInfo__I3ULx",headerActions:"PublicProfilePage_headerActions__R1W5P",profileContent:"PublicProfilePage_profileContent__hJJYD",leftColumn:"PublicProfilePage_leftColumn__1YjzC",rightColumn:"PublicProfilePage_rightColumn__bLWSB",infoCard:"PublicProfilePage_infoCard__eInb5",detailItem:"PublicProfilePage_detailItem__fj7Wz",tagsContainer:"PublicProfilePage_tagsContainer__vHjBb",tag:"PublicProfilePage_tag__NnmVS",aboutSection:"PublicProfilePage_aboutSection__HuvC9",mealsSection:"PublicProfilePage_mealsSection__B2wJ4",mealsGrid:"PublicProfilePage_mealsGrid__BNp5D",mealList:"PublicProfilePage_mealList__ZKSam",mealLink:"PublicProfilePage_mealLink__It5e2",mealTitle:"PublicProfilePage_mealTitle__qqAwX",mealDate:"PublicProfilePage_mealDate__uzVsC",accordionSection:"PublicProfilePage_accordionSection__AZnfS","accordion-item":"PublicProfilePage_accordion-item__IoIum","accordion-button":"PublicProfilePage_accordion-button__mn9+c",collapsed:"PublicProfilePage_collapsed__as0BN","accordion-body":"PublicProfilePage_accordion-body__QmdAm"};var d=s(3519),m=s(7417),u=s(1719),_=s(4282),h=s(1072),x=s(8602),p=s(8628),j=s(4063),g=s(1177),f=s(184),b=(s(4122),s(1271),s(2619),s(7352),s(7102));const P={toast:"Toast_toast__ayQTO",show:"Toast_show__B7Eps",hide:"Toast_hide__ghqaI",success:"Toast_success__10DRA",error:"Toast_error__Weah5",icon:"Toast_icon__r4Eq6",message:"Toast_message__1ZUp4",closeButton:"Toast_closeButton__j0zVC"};var v=s(579);const N=e=>{let{message:a,type:s="success",duration:r=3e3,onClose:i}=e;const[t,n]=(0,l.useState)(!0);(0,l.useEffect)(()=>{const e=setTimeout(()=>{n(!1),setTimeout(()=>{i&&i()},300)},r);return()=>clearTimeout(e)},[r,i]);return(0,v.jsxs)("div",{className:"".concat(P.toast," ").concat(P[s]," ").concat(t?P.show:P.hide),children:[(0,v.jsx)("div",{className:P.icon,children:(()=>{switch(s){case"success":default:return(0,v.jsx)(f.A7C,{});case"error":return(0,v.jsx)(f._Hm,{})}})()}),(0,v.jsx)("div",{className:P.message,children:a}),(0,v.jsx)("button",{className:P.closeButton,onClick:()=>{n(!1),setTimeout(()=>{i&&i()},300)},children:(0,v.jsx)(f.QCr,{})})]})};var A=s(2555),C=s(5849),I=s(8298);const k="ReportModal_userInfo__ZrKZL",M="ReportModal_userAvatar__ZgtlD",y=e=>{let{show:a,onHide:s,reportedUser:r,context:i="general",mealId:n=null}=e;const{t:c}=(0,t.Bd)(),[o,d]=(0,l.useState)({reason:"",details:""}),[m,h]=(0,l.useState)(!1),[x,p]=(0,l.useState)(""),[j,g]=(0,l.useState)(!1),f=[{value:"inappropriate",label:c("report.reasons.inappropriate")},{value:"spam",label:c("report.reasons.spam")},{value:"fakeProfile",label:c("report.reasons.fakeProfile")},{value:"other",label:c("report.reasons.other")}],P=async e=>{if(e.preventDefault(),o.reason){h(!0),p("");try{const e={reportedUserId:r._id,reason:o.reason,details:o.details,context:i};n&&(e.meal=n),await(0,b.LU)(e),g(!0),setTimeout(()=>{s(),g(!1),d({reason:"",details:""})},2e3)}catch(t){var a,l;p((null===(a=t.response)||void 0===a||null===(l=a.data)||void 0===l?void 0:l.message)||c("report.sendError"))}finally{h(!1)}}else p(c("report.selectReasonError"))},N=()=>{m||(s(),d({reason:"",details:""}),p(""),g(!1))};return(0,v.jsxs)(C.A,{show:a,onHide:N,centered:!0,children:[(0,v.jsx)(C.A.Header,{closeButton:!0,children:(0,v.jsx)(C.A.Title,{children:c("report.reportUser")})}),(0,v.jsx)(C.A.Body,{children:j?(0,v.jsx)(u.A,{variant:"success",children:c("report.reportSuccess")}):(0,v.jsxs)(v.Fragment,{children:[(0,v.jsxs)("div",{className:k,children:[(0,v.jsx)("img",{src:null!==r&&void 0!==r&&r.profileImage?"/uploads/profile-images/".concat(r.profileImage):"/default-avatar.jpg",alt:null===r||void 0===r?void 0:r.nickname,className:M}),(0,v.jsxs)("div",{children:[(0,v.jsx)("h6",{children:null===r||void 0===r?void 0:r.nickname}),(0,v.jsx)("small",{className:"text-muted",children:c("report.userToReport")})]})]}),x&&(0,v.jsx)(u.A,{variant:"danger",children:x}),(0,v.jsxs)(I.A,{onSubmit:P,children:[(0,v.jsxs)(I.A.Group,{className:"mb-3",children:[(0,v.jsx)(I.A.Label,{children:c("report.reportReason")}),(0,v.jsxs)(I.A.Select,{value:o.reason,onChange:e=>d((0,A.A)((0,A.A)({},o),{},{reason:e.target.value})),required:!0,children:[(0,v.jsx)("option",{value:"",children:c("report.selectReason")}),f.map(e=>(0,v.jsx)("option",{value:e.value,children:e.label},e.value))]})]}),(0,v.jsxs)(I.A.Group,{className:"mb-3",children:[(0,v.jsx)(I.A.Label,{children:c("report.additionalDetails")}),(0,v.jsx)(I.A.Control,{as:"textarea",rows:3,value:o.details,onChange:e=>d((0,A.A)((0,A.A)({},o),{},{details:e.target.value})),placeholder:c("report.detailsPlaceholder")})]})]})]})}),(0,v.jsx)(C.A.Footer,{children:!j&&(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(_.A,{variant:"secondary",onClick:N,disabled:m,children:c("report.cancel")}),(0,v.jsx)(_.A,{variant:"danger",onClick:P,disabled:m||!o.reason,children:c(m?"report.sending":"report.sendReport")})]})})]})},T="BlockUserMenu_menuContainer__GIrpU",B="BlockUserMenu_kebabButton__gsN-s",S="BlockUserMenu_dropdown__xZDIe",w="BlockUserMenu_menuItem__gk5Lf",U="BlockUserMenu_blockButton__m-1-g",L="BlockUserMenu_unblockButton__ArCI0",D="BlockUserMenu_reportButton__rM9MX",H=e=>{let{userId:a,reportedUser:s,onBlockChange:r}=e;const{t:i}=(0,t.Bd)(),[n,c]=(0,l.useState)(!1),[o,d]=(0,l.useState)(!1),[m,u]=(0,l.useState)(!1),[_,h]=(0,l.useState)(!0),[x,p]=(0,l.useState)(null),[j,g]=(0,l.useState)(!1);(0,l.useEffect)(()=>{a&&(async()=>{try{h(!0);const e=await(0,b.O3)(a);d(e.data.data.isBlocked)}catch(e){console.error("Errore nel controllare lo stato di blocco:",e)}finally{h(!1)}})()},[a]);return(0,l.useEffect)(()=>{const e=e=>{n&&!e.target.closest(".".concat(T))&&c(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[n]),_?(0,v.jsx)("div",{className:T,children:(0,v.jsx)("button",{className:B,disabled:!0,children:(0,v.jsx)(f.H_v,{})})}):(0,v.jsxs)(v.Fragment,{children:[(0,v.jsxs)("div",{className:T,children:[(0,v.jsx)("button",{className:B,onClick:()=>{c(!n)},disabled:m,children:(0,v.jsx)(f.H_v,{})}),n&&(0,v.jsxs)("div",{className:S,children:[(0,v.jsx)("button",{className:"".concat(w," ").concat(o?L:U),onClick:async()=>{try{u(!0),o?(await(0,b.kV)(a),d(!1),r&&r(!1),p({message:i("userBlock.unblockSuccess"),type:"success"})):(await(0,b.rn)(a),d(!0),r&&r(!0),p({message:i("userBlock.blockSuccess"),type:"success"})),c(!1)}catch(e){console.error("Errore nel blocco/sblocco utente:",e),p({message:"Errore durante l'operazione. Riprova.",type:"error"})}finally{u(!1)}},disabled:m,children:o?(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(f.BAG,{}),i("userBlock.unblockUser")]}):(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(f.Rqy,{}),i("userBlock.blockUser")]})}),(0,v.jsxs)("button",{className:"".concat(w," ").concat(D),onClick:()=>{g(!0),c(!1)},children:[(0,v.jsx)(f.O5k,{}),"Segnala Utente"]})]})]}),x&&(0,v.jsx)(N,{message:x.message,type:x.type,onClose:()=>p(null)}),j&&s&&(0,v.jsx)(y,{show:j,onHide:()=>g(!1),reportedUser:s,context:"profile"})]})},E=()=>{var e,a,s;const{t:b}=(0,t.Bd)(),{userId:P}=(0,r.g)(),{user:N}=(0,n.A)(),[A,C]=(0,l.useState)(null),[I,k]=(0,l.useState)(!0),[M,y]=(0,l.useState)(""),[T,B]=(0,l.useState)(!1),S=(null===N||void 0===N?void 0:N._id)===P,w=(0,l.useCallback)(async()=>{console.log("\ud83d\udc64 [PublicProfile] Fetching profile for userId:",P),k(!0),y("");try{const e=await c.A.getPublicProfileById(P);C(e)}catch(e){y(e.message||b("publicProfile.loadError"))}finally{k(!1)}},[P,b]);(0,l.useEffect)(()=>{w()},[w]);if(I)return(0,v.jsx)(d.A,{className:"text-center py-5",children:(0,v.jsx)(m.A,{animation:"border"})});if(M||!A)return(0,v.jsx)(d.A,{className:"text-center py-5",children:(0,v.jsx)(u.A,{variant:"danger",children:M||b("publicProfile.loadError")})});const U=(null===(e=A.joinedMeals)||void 0===e?void 0:e.filter(e=>{var a;return!(null!==(a=A.createdMeals)&&void 0!==a&&a.some(a=>a._id===e._id))}))||[],L=A.createdMeals||[],D=L.slice(0,3),E=U.slice(0,3);return(0,v.jsx)("div",{className:o.profilePageBackground,children:(0,v.jsxs)(d.A,{className:o.profileContainer,children:[(0,v.jsxs)("header",{className:o.profileHeader,children:[(()=>{const e=c.A.getFullImageUrl(A.profileImage);return console.log("\ud83d\udc64 [PublicProfile] Profile image URL:",e),console.log("\ud83d\udc64 [PublicProfile] Profile image field:",A.profileImage),(0,v.jsx)("img",{src:e,alt:A.nickname,className:o.profileAvatar,onError:e=>{console.log("\u274c Errore caricamento immagine profilo:",e);try{const a=c.A.getFullImageUrl("uploads/profile-images/default-avatar.jpg");e.target.src=a}catch(a){}}})})(),(0,v.jsxs)("div",{className:o.headerInfo,children:[(0,v.jsx)("h1",{children:A.nickname}),(0,v.jsx)("div",{className:o.headerActions,children:S?(0,v.jsx)(_.A,{as:i.N_,to:"/impostazioni/profilo",variant:"secondary",size:"sm",children:b("publicProfile.editProfile")}):(0,v.jsx)(H,{userId:P,reportedUser:A,onBlockChange:e=>{B(e),e&&window.history.back()}})})]})]}),(0,v.jsx)("main",{className:o.profileContent,children:(0,v.jsxs)(h.A,{children:[(0,v.jsx)(x.A,{lg:4,className:o.leftColumn,children:(0,v.jsx)(p.A,{className:o.infoCard,children:(0,v.jsxs)(p.A.Body,{children:[(0,v.jsx)(p.A.Title,{className:o.cardTitle,children:b("publicProfile.inBrief")}),A.location&&(0,v.jsxs)("div",{className:o.detailItem,children:[(0,v.jsx)(f.vq8,{})," ",b("publicProfile.from")," ",(0,v.jsx)("strong",{children:A.location})]}),A.age&&(0,v.jsxs)("div",{className:o.detailItem,children:[(0,v.jsx)(f.V4G,{})," ",(0,v.jsx)("strong",{children:A.age})," ",b("publicProfile.years")]}),A.gender&&(0,v.jsxs)("div",{className:o.detailItem,children:[b("publicProfile.gender"),": ",(0,v.jsx)("strong",{children:(R=A.gender,R&&R.charAt(0).toUpperCase()+R.slice(1))})]}),(0,v.jsx)("hr",{}),(0,v.jsxs)("h5",{className:o.detailSubtitle,children:[(0,v.jsx)(f.uN,{})," ",b("publicProfile.languages")]}),(0,v.jsx)("div",{className:o.tagsContainer,children:(null===(a=A.languages)||void 0===a?void 0:a.length)>0?A.languages.map(e=>(0,v.jsx)(j.A,{pill:!0,bg:"success",className:o.tag,children:e},e)):(0,v.jsx)("p",{className:"text-muted small",children:b("publicProfile.noLanguages")})}),(0,v.jsx)("hr",{}),(0,v.jsxs)("h5",{className:o.detailSubtitle,children:[(0,v.jsx)(f.xBk,{})," ",b("publicProfile.preferredCuisine")]}),A.preferredCuisine?(0,v.jsx)(j.A,{pill:!0,bg:"warning",text:"dark",className:o.tag,children:A.preferredCuisine}):(0,v.jsx)("p",{className:"text-muted small",children:b("publicProfile.noPreference")})]})})}),(0,v.jsxs)(x.A,{lg:8,className:o.rightColumn,children:[(0,v.jsx)(p.A,{className:o.infoCard,children:(0,v.jsxs)(p.A.Body,{children:[(0,v.jsxs)("h2",{className:o.sectionTitle,children:[(0,v.jsx)(f.Mbv,{})," ",b("publicProfile.whoIAm")]}),(0,v.jsx)("p",{className:o.bioText,children:A.bio||b("publicProfile.noBio")})]})}),(0,v.jsx)("div",{className:o.accordionSection,children:(0,v.jsxs)(g.A,{children:[(0,v.jsxs)(g.A.Item,{eventKey:"0",children:[(0,v.jsxs)(g.A.Header,{children:[b("publicProfile.organizedMeals")," (",(null===(s=A.createdMeals)||void 0===s?void 0:s.length)||0,")"]}),(0,v.jsx)(g.A.Body,{children:L.length>0?(0,v.jsxs)("ul",{className:o.mealList,children:[D.map(e=>(0,v.jsx)("li",{children:(0,v.jsxs)(i.N_,{to:"/meals/".concat(e._id),className:o.mealLink,children:[(0,v.jsx)("span",{className:o.mealTitle,children:e.title}),(0,v.jsx)("span",{className:o.mealDate,children:new Date(e.date).toLocaleDateString("it-IT")})]})},e._id)),L.length>3&&(0,v.jsxs)("li",{className:"text-muted small",children:["Mostrati 3 su ",L.length]})]}):(0,v.jsx)("p",{className:"text-muted small",children:b("publicProfile.noOrganizedMeals")})})]}),(0,v.jsxs)(g.A.Item,{eventKey:"1",children:[(0,v.jsxs)(g.A.Header,{children:[b("publicProfile.recentParticipations")," (",U.length,")"]}),(0,v.jsx)(g.A.Body,{children:U.length>0?(0,v.jsxs)("ul",{className:o.mealList,children:[E.map(e=>(0,v.jsx)("li",{children:(0,v.jsxs)(i.N_,{to:"/meals/".concat(e._id),className:o.mealLink,children:[(0,v.jsx)("span",{className:o.mealTitle,children:e.title}),(0,v.jsx)("span",{className:o.mealDate,children:new Date(e.date).toLocaleDateString("it-IT")})]})},e._id)),U.length>3&&(0,v.jsxs)("li",{className:"text-muted small",children:["Mostrati 3 su ",U.length]})]}):(0,v.jsx)("p",{className:"text-muted small",children:b("publicProfile.noParticipations")})})]})]})})]})]})})]})});var R}}}]);
//# sourceMappingURL=933.f40acd6e.chunk.js.map