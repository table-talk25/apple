"use strict";(self.webpackChunktable_talk_client=self.webpackChunktable_talk_client||[]).push([[903],{549:(e,a,t)=>{t.d(a,{A:()=>x});var s=t(5043),i=t(9896),n=t(9419),l=t(6036),o=t(3318),c=t(2023),r=t(228),d=t.n(r),m=(t(6433),t(579));function p(e){let{position:a}=e;const t=(0,i.ko)();return(0,s.useEffect)(()=>{a&&t.setView([a.lat,a.lng],t.getZoom())},[a,t]),null}function h(e){let{onLocationSelect:a,onMapClick:t}=e;return(0,i.Po)({click(e){const{lat:s,lng:i}=e.latlng;t&&t(),a&&a({lat:s,lng:i})}}),null}delete d().Icon.Default.prototype._getIconUrl,d().Icon.Default.mergeOptions({iconRetinaUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon-2x.png",iconUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png"});const x=e=>{let{meals:a=[],markers:t=[],onLocationSelect:i,onMarkerClick:r,onMapClick:x,selectedLocation:g,userLocation:u=null,zoom:j=13,height:b="400px",width:f="100%",center:v=[45.4642,9.19]}=e;const[y,_]=(0,s.useState)(""),[w,N]=(0,s.useState)([]),[A,k]=(0,s.useState)(!1),C=async e=>{if(e&&!(e.length<3)){k(!0);try{const a=await fetch("https://nominatim.openstreetmap.org/search?format=json&q=".concat(encodeURIComponent(e),"&limit=5&countrycodes=it&addressdetails=1")),t=(await a.json()).map(e=>({id:e.place_id,name:e.display_name,lat:parseFloat(e.lat),lng:parseFloat(e.lon),address:e.display_name}));N(t)}catch(a){console.error("Errore ricerca luoghi:",a),N([])}finally{k(!1)}}};return(0,m.jsxs)("div",{style:{width:"100%"},children:[(0,m.jsxs)("div",{style:{marginBottom:"10px"},children:[(0,m.jsxs)("div",{style:{position:"relative"},children:[(0,m.jsx)("input",{type:"text",placeholder:"\ud83d\udd0d Cerca ristoranti, indirizzi...",value:y,onChange:e=>_(e.target.value),onKeyPress:e=>"Enter"===e.key&&C(y),style:{width:"100%",padding:"12px",border:"2px solid #ddd",borderRadius:"8px",fontSize:"16px"}}),(0,m.jsx)("button",{onClick:()=>C(y),disabled:A,style:{position:"absolute",right:"8px",top:"50%",transform:"translateY(-50%)",background:"#FF6B35",color:"white",border:"none",padding:"8px 12px",borderRadius:"6px",cursor:"pointer"},children:A?"...":"Cerca"})]}),w.length>0&&(0,m.jsx)("div",{style:{position:"absolute",zIndex:1e3,background:"white",border:"1px solid #ddd",borderRadius:"8px",marginTop:"5px",maxHeight:"200px",overflowY:"auto",width:"100%"},children:w.map(e=>(0,m.jsxs)("div",{onClick:()=>{i&&i({lat:e.lat,lng:e.lng,address:e.address}),N([]),_(e.name.split(",")[0])},style:{padding:"10px",cursor:"pointer",borderBottom:"1px solid #eee",fontSize:"14px"},onMouseEnter:e=>e.target.style.backgroundColor="#f5f5f5",onMouseLeave:e=>e.target.style.backgroundColor="white",children:["\ud83d\udccd ",e.name]},e.id))})]}),(0,m.jsxs)(n.W,{center:v,zoom:j,style:{height:b,width:f,borderRadius:"8px"},children:[(0,m.jsx)(c.e,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:'\xa9 <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}),(0,m.jsx)(h,{onLocationSelect:i,onMapClick:x}),g&&(0,m.jsx)(p,{position:g}),u&&(0,m.jsx)(l.p,{position:[u.lat,u.lng],icon:d().icon({iconUrl:"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-blue.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),children:(0,m.jsxs)(o.z,{children:["\ud83d\udccd ",(0,m.jsx)("strong",{children:"La tua posizione"})]})}),g&&(0,m.jsx)(l.p,{position:[g.lat,g.lng],children:(0,m.jsxs)(o.z,{children:["\ud83d\udccd ",(0,m.jsx)("strong",{children:"Posizione selezionata"}),(0,m.jsx)("br",{}),g.address||"".concat(g.lat.toFixed(4),", ").concat(g.lng.toFixed(4))]})}),t.map(e=>(0,m.jsx)(l.p,{position:[e.lat,e.lng],eventHandlers:{click:()=>{r&&r(e.id)}},children:(0,m.jsx)(o.z,{children:(0,m.jsxs)("div",{style:{minWidth:"200px"},children:[(0,m.jsxs)("h3",{style:{margin:"0 0 8px 0",color:"#FF6B35"},children:["\ud83c\udf7d\ufe0f ",e.title||e.name]}),e.price&&(0,m.jsxs)("p",{style:{margin:"4px 0"},children:["\ud83d\udcb0 \u20ac",e.price]}),e.type&&(0,m.jsxs)("p",{style:{margin:"4px 0",color:"#666"},children:["\ud83d\udcc5 ",e.type]})]})})},e.id)),a.map(e=>(0,m.jsx)(l.p,{position:[e.lat,e.lng],eventHandlers:{click:()=>{r&&r(e.id)}},children:(0,m.jsx)(o.z,{children:(0,m.jsxs)("div",{style:{minWidth:"200px"},children:[(0,m.jsxs)("h3",{style:{margin:"0 0 8px 0",color:"#FF6B35"},children:["\ud83c\udf7d\ufe0f ",e.name]}),(0,m.jsxs)("p",{style:{margin:"4px 0"},children:["\ud83d\udccd ",e.restaurant||e.address]}),(0,m.jsxs)("p",{style:{margin:"4px 0"},children:["\ud83d\udc65 ",e.participants||0," partecipanti"]}),(0,m.jsxs)("p",{style:{margin:"4px 0"},children:["\ud83d\udcc5 ",e.date]}),(0,m.jsx)("button",{onClick:()=>window.open("/meal/".concat(e.id),"_blank"),style:{background:"#FF6B35",color:"white",border:"none",padding:"8px 16px",borderRadius:"6px",cursor:"pointer",marginTop:"8px"},children:"Partecipa al TableTalk"})]})})},e.id))]})]})}},1072:(e,a,t)=>{t.d(a,{A:()=>p});var s=t(2555),i=t(45),n=t(8139),l=t.n(n),o=t(5043),c=t(7852),r=t(579);const d=["bsPrefix","className","as"],m=o.forwardRef((e,a)=>{let{bsPrefix:t,className:n,as:o="div"}=e,m=(0,i.A)(e,d);const p=(0,c.oU)(t,"row"),h=(0,c.gy)(),x=(0,c.Jm)(),g="".concat(p,"-cols"),u=[];return h.forEach(e=>{const a=m[e];let t;delete m[e],null!=a&&"object"===typeof a?({cols:t}=a):t=a;const s=e!==x?"-".concat(e):"";null!=t&&u.push("".concat(g).concat(s,"-").concat(t))}),(0,r.jsx)(o,(0,s.A)((0,s.A)({ref:a},m),{},{className:l()(n,p,...u)}))});m.displayName="Row";const p=m},3519:(e,a,t)=>{t.d(a,{A:()=>p});var s=t(2555),i=t(45),n=t(8139),l=t.n(n),o=t(5043),c=t(7852),r=t(579);const d=["bsPrefix","fluid","as","className"],m=o.forwardRef((e,a)=>{let{bsPrefix:t,fluid:n=!1,as:o="div",className:m}=e,p=(0,i.A)(e,d);const h=(0,c.oU)(t,"container"),x="string"===typeof n?"-".concat(n):"-fluid";return(0,r.jsx)(o,(0,s.A)((0,s.A)({ref:a},p),{},{className:l()(m,n?"".concat(h).concat(x):h)}))});m.displayName="Container";const p=m},3903:(e,a,t)=>{t.r(a),t.d(a,{default:()=>k});var s=t(5043),i=t(3216),n=t(7417),l=t(3519),o=t(1719),c=t(4063),r=t(1072),d=t(8602),m=t(4282),p=t(4117),h=t(3401),x=t(184),g=t(2179),u=t(5016),j=t(5950),b=t(549),f=t(7352),v=t(9926);const y="JoinMealButton_joinButton__6Iq+8";var _=t(579);const w=e=>{let{mealId:a,onSuccess:t}=e;const{joinMeal:s,loading:i}=(0,v.w)();return(0,_.jsx)(m.A,{className:y,onClick:async()=>{try{const e=await s(a);e&&t&&t(e)}catch(e){console.error("Fallimento joinMeal nel componente:",e)}},disabled:i,children:i?(0,_.jsxs)(_.Fragment,{children:[(0,_.jsx)(n.A,{as:"span",animation:"border",size:"sm",role:"status","aria-hidden":"true"}),(0,_.jsx)("span",{children:" Attendi..."})]}):"Unisciti al TableTalk\xae"})};var N=t(6229);const A={pageContainer:"MealDetailPage_pageContainer__rTQhF",heroImage:"MealDetailPage_heroImage__Qwr+O",overlay:"MealDetailPage_overlay__nDA0r",title:"MealDetailPage_title__WmRuQ",contentContainer:"MealDetailPage_contentContainer__sAwLx",card:"MealDetailPage_card__PBjFk",actionCard:"MealDetailPage_actionCard__jOaaO",hostInfo:"MealDetailPage_hostInfo__21qzD",hostAvatar:"MealDetailPage_hostAvatar__iOzJc",infoGrid:"MealDetailPage_infoGrid__y0e5k",infoItem:"MealDetailPage_infoItem__K86Ch",icon:"MealDetailPage_icon__a8EpR",description:"MealDetailPage_description__0Zl80",topicsContainer:"MealDetailPage_topicsContainer__uKoCV",avatarList:"MealDetailPage_avatarList__LrcPT",miniAvatar:"MealDetailPage_miniAvatar__sXV9q"},k=()=>{var e,a,t,v,y,k,C,P,D;const{t:I}=(0,p.Bd)(),{mealId:M}=(0,i.g)(),z=(0,i.Zp)(),{user:S}=(0,u.A)(),[T,L]=(0,s.useState)(null),[F,R]=(0,s.useState)(!0),[B,U]=(0,s.useState)(null),[E,H]=(0,s.useState)(!1),q=(0,s.useCallback)(async()=>{try{R(!0);const e=await g.A.getMealById(M);L(e.data||e)}catch(e){console.error("Errore caricamento pasto:",e),U(I("meals.detail.loadError")||"Impossibile caricare il pasto.")}finally{R(!1)}},[M,I]);(0,s.useEffect)(()=>{q()},[q]);const O=()=>{q()};if(F)return(0,_.jsx)("div",{className:"d-flex justify-content-center py-5",children:(0,_.jsx)(n.A,{animation:"border"})});if(B)return(0,_.jsxs)(l.A,{className:"py-5",children:[(0,_.jsx)(o.A,{variant:"danger",children:B}),(0,_.jsx)(f.A,{})]});if(!T)return(0,_.jsxs)(l.A,{className:"py-5",children:[(0,_.jsx)(o.A,{variant:"warning",children:"Pasto non trovato"}),(0,_.jsx)(f.A,{})]});const Q=S&&((null===(e=T.host)||void 0===e?void 0:e._id)===S._id||T.host===S._id),V=S&&(null===(a=T.participants)||void 0===a?void 0:a.some(e=>(e._id||e)===S._id)),W="virtual"===T.mealType,Z=(null===(t=T.participants)||void 0===t||t.length,T.maxParticipants,new Date(T.date)<new Date),G=new Date(T.date),J=new Date,K=60*(T.duration||60)*1e3,X=new Date(G.getTime()+K),Y=new Date(G.getTime()-6e5),$=W&&(V||Q)&&J>=Y&&J<=X,ee=W&&(V||Q)&&J<Y&&J>new Date(G.getTime()-864e5);return(0,_.jsxs)("div",{className:A.pageContainer,children:[(0,_.jsx)("div",{className:A.heroImage,style:{backgroundImage:"url(".concat((0,j.xW)(T.imageUrl),")")},children:(0,_.jsx)("div",{className:A.overlay,children:(0,_.jsxs)(l.A,{children:[(0,_.jsx)(f.A,{className:"mb-3 text-white"}),(0,_.jsx)(c.A,{bg:W?"info":"success",className:"mb-2",children:I(W?"meals.type.virtual":"meals.type.physical")}),(0,_.jsx)("h1",{className:A.title,children:T.title})]})})}),(0,_.jsx)(l.A,{className:A.contentContainer,children:(0,_.jsxs)(r.A,{children:[(0,_.jsxs)(d.A,{lg:8,children:[(0,_.jsxs)("div",{className:A.card,children:[(0,_.jsxs)("div",{className:A.hostInfo,children:[(0,_.jsx)("img",{src:(0,j.DP)(T.host),alt:null===(v=T.host)||void 0===v?void 0:v.nickname,className:A.hostAvatar}),(0,_.jsxs)("div",{children:[(0,_.jsx)("p",{className:"mb-0 text-muted",children:I("meals.detail.hostedBy")}),(0,_.jsx)("strong",{children:(null===(y=T.host)||void 0===y?void 0:y.nickname)||"Host"})]})]}),(0,_.jsxs)("div",{className:A.infoGrid,children:[(0,_.jsxs)("div",{className:A.infoItem,children:[(0,_.jsx)(x.bfZ,{className:A.icon}),(0,_.jsxs)("div",{children:[(0,_.jsx)("label",{children:I("meals.form.dateLabel")}),(0,_.jsx)("p",{children:new Date(T.date).toLocaleDateString()})]})]}),(0,_.jsxs)("div",{className:A.infoItem,children:[(0,_.jsx)(x.w_X,{className:A.icon}),(0,_.jsxs)("div",{children:[(0,_.jsx)("label",{children:I("meals.form.timeLabel")}),(0,_.jsx)("p",{children:new Date(T.date).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})]}),(0,_.jsxs)("div",{className:A.infoItem,children:[(0,_.jsx)(x.YXz,{className:A.icon}),(0,_.jsxs)("div",{children:[(0,_.jsx)("label",{children:I("meals.detail.participants")}),(0,_.jsxs)("p",{children:[(null===(k=T.participants)||void 0===k?void 0:k.length)||0," / ",T.maxParticipants]})]})]})]}),(0,_.jsx)("hr",{}),(0,_.jsx)("h3",{children:I("meals.form.descriptionLabel")}),(0,_.jsx)("p",{className:A.description,children:T.description}),T.topics&&T.topics.length>0&&(0,_.jsxs)("div",{className:"mb-4",children:[(0,_.jsx)("h5",{children:I("meals.form.topicsLabel")}),(0,_.jsx)("div",{className:A.topicsContainer,children:T.topics.map((e,a)=>(0,_.jsxs)(c.A,{bg:"light",text:"dark",className:"me-2 p-2 border",children:["#",e]},a))})]})]}),!W&&T.location&&T.location.coordinates&&(0,_.jsxs)("div",{className:A.card,children:[(0,_.jsxs)("h4",{className:"mb-3",children:[(0,_.jsx)(x.vq8,{className:"me-2"}),I("meals.detail.location")]}),(0,_.jsx)("p",{className:"text-muted",children:T.location.address}),(0,_.jsx)("div",{style:{height:"300px",borderRadius:"10px",overflow:"hidden"},children:(0,_.jsx)(b.A,{readOnly:!0,center:[T.location.coordinates[1],T.location.coordinates[0]],zoom:15,markers:[{lat:T.location.coordinates[1],lng:T.location.coordinates[0],title:T.title}]})}),(0,_.jsx)(m.A,{variant:"outline-primary",className:"mt-3 w-100",onClick:()=>window.open("https://www.google.com/maps/search/?api=1&query=".concat(T.location.coordinates[1],",").concat(T.location.coordinates[0]),"_blank"),children:"Apri in Google Maps \ud83d\uddfa\ufe0f"})]})]}),(0,_.jsx)(d.A,{lg:4,children:(0,_.jsxs)("div",{className:"".concat(A.card," ").concat(A.actionCard),children:[(0,_.jsx)("h4",{className:"mb-4",children:I("meals.detail.actions")}),!Q&&!V&&!Z&&(0,_.jsx)(w,{meal:T,onSuccess:O,className:"w-100 mb-3 btn-lg"}),!Q&&V&&!Z&&(0,_.jsx)(N.A,{mealId:T._id,onSuccess:O,className:"w-100 mb-3 btn-outline-danger"}),(V||Q)&&T.chatId&&(0,_.jsxs)(m.A,{variant:"primary",className:"w-100 mb-3 d-flex align-items-center justify-content-center gap-2",onClick:()=>{if(T.chatId){const e="object"===typeof T.chatId?T.chatId._id:T.chatId;z("/chats/".concat(e))}else h.oR.error(I("chat.notAvailable")||"Chat non ancora disponibile")},children:[(0,_.jsx)(x.j1Q,{})," ",I("meals.detail.openChat")]}),$?(0,_.jsxs)(m.A,{variant:"success",className:"w-100 mb-3 d-flex align-items-center justify-content-center gap-2",onClick:()=>{z("/meals/".concat(T._id,"/video"))},children:[(0,_.jsx)(x.HiP,{})," ",I("meals.detail.joinVideo")]}):ee&&(0,_.jsxs)("div",{className:"w-100 mb-3 text-center text-muted small border p-2 rounded bg-light",children:[(0,_.jsx)(x.HiP,{className:"me-1"}),"Video disponibile dalle ",Y.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]}),(0,_.jsxs)(m.A,{variant:"outline-secondary",className:"w-100",onClick:()=>{navigator.share?navigator.share({title:T.title,text:"Unisciti a me per ".concat(T.title," su TableTalk!"),url:window.location.href}):(navigator.clipboard.writeText(window.location.href),h.oR.success("Link copiato negli appunti!"))},children:[(0,_.jsx)(x.eb3,{className:"me-2"})," ",I("common.share")]}),(0,_.jsxs)("div",{className:"mt-4",children:[(0,_.jsxs)("h5",{children:[I("meals.detail.participantsList")," (",(null===(C=T.participants)||void 0===C?void 0:C.length)||0,")"]}),(0,_.jsxs)("div",{className:A.avatarList,children:[(0,_.jsx)("div",{className:A.participantItem,title:"Host: ".concat(null===(P=T.host)||void 0===P?void 0:P.nickname),children:(0,_.jsx)("img",{src:(0,j.DP)(T.host),className:A.miniAvatar,style:{border:"2px solid #ff6b6b"},alt:"Host"})}),null===(D=T.participants)||void 0===D?void 0:D.map(e=>(e._id||e)!==(T.host._id||T.host)&&(0,_.jsx)("div",{className:A.participantItem,title:e.nickname,children:(0,_.jsx)("img",{src:(0,j.DP)(e),className:A.miniAvatar,alt:e.nickname||"User"})},e._id||e))]})]})]})})]})})]})}},4063:(e,a,t)=>{t.d(a,{A:()=>p});var s=t(2555),i=t(45),n=t(8139),l=t.n(n),o=t(5043),c=t(7852),r=t(579);const d=["bsPrefix","bg","pill","text","className","as"],m=o.forwardRef((e,a)=>{let{bsPrefix:t,bg:n="primary",pill:o=!1,text:m,className:p,as:h="span"}=e,x=(0,i.A)(e,d);const g=(0,c.oU)(t,"badge");return(0,r.jsx)(h,(0,s.A)((0,s.A)({ref:a},x),{},{className:l()(p,g,o&&"rounded-pill",m&&"text-".concat(m),n&&"bg-".concat(n))}))});m.displayName="Badge";const p=m},6229:(e,a,t)=>{t.d(a,{A:()=>o});t(5043);var s=t(9926),i=t(4282),n=t(7417),l=t(579);const o=e=>{let{mealId:a,onSuccess:t}=e;const{leaveMeal:o,loading:c}=(0,s.w)();return(0,l.jsx)(i.A,{variant:"outline-danger",className:"w-100",onClick:async()=>{if(window.confirm("Sei sicuro di voler abbandonare questo TableTalk\xae?"))try{const e=await o(a);t&&t(e)}catch(e){console.error("Fallimento leaveMeal nel componente:",e)}},disabled:c,children:c?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.A,{as:"span",animation:"border",size:"sm"}),(0,l.jsx)("span",{children:" Uscita in corso..."})]}):"Abbandona il TableTalk\xae"})}},7352:(e,a,t)=>{t.d(a,{A:()=>o});t(5043);var s=t(3216),i=t(184);const n="BackButton_backButton__hBNQM";var l=t(579);const o=e=>{let{className:a=""}=e;const t=(0,s.Zp)();return(0,l.jsxs)("button",{onClick:()=>{t(-1)},className:"".concat(n," ").concat(a),children:[(0,l.jsx)(i.QVr,{style:{marginRight:8}}),"Torna indietro"]})}},8602:(e,a,t)=>{t.d(a,{A:()=>h});var s=t(2555),i=t(45),n=t(8139),l=t.n(n),o=t(5043),c=t(7852),r=t(579);const d=["as","bsPrefix","className"],m=["className"];const p=o.forwardRef((e,a)=>{const[t,{as:n="div",bsPrefix:o,spans:p}]=function(e){let{as:a,bsPrefix:t,className:n}=e,o=(0,i.A)(e,d);t=(0,c.oU)(t,"col");const r=(0,c.gy)(),m=(0,c.Jm)(),p=[],h=[];return r.forEach(e=>{const a=o[e];let s,i,n;delete o[e],"object"===typeof a&&null!=a?({span:s,offset:i,order:n}=a):s=a;const l=e!==m?"-".concat(e):"";s&&p.push(!0===s?"".concat(t).concat(l):"".concat(t).concat(l,"-").concat(s)),null!=n&&h.push("order".concat(l,"-").concat(n)),null!=i&&h.push("offset".concat(l,"-").concat(i))}),[(0,s.A)((0,s.A)({},o),{},{className:l()(n,...p,...h)}),{as:a,bsPrefix:t,spans:p}]}(e),{className:h}=t,x=(0,i.A)(t,m);return(0,r.jsx)(n,(0,s.A)((0,s.A)({},x),{},{ref:a,className:l()(h,!p.length&&o)}))});p.displayName="Col";const h=p}}]);
//# sourceMappingURL=903.42b9a550.chunk.js.map