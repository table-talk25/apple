"use strict";(self.webpackChunktable_talk_client=self.webpackChunktable_talk_client||[]).push([[740],{549:(e,t,a)=>{a.d(t,{A:()=>f});var n=a(5043),i=a(9896),o=a(9419),s=a(6036),r=a(3318),l=a(2023),c=a(228),m=a.n(c),d=(a(6433),a(579));function p(e){let{position:t,zoom:a}=e;const o=(0,i.ko)();return(0,n.useEffect)(()=>{if(t&&t.lat&&t.lng){const e=a||o.getZoom();o.flyTo([t.lat,t.lng],e,{duration:1.5})}},[null===t||void 0===t?void 0:t.lat,null===t||void 0===t?void 0:t.lng,a,o]),null}function u(e){let{center:t,zoom:a}=e;const o=(0,i.ko)();return(0,n.useEffect)(()=>{if(t&&Array.isArray(t)&&2===t.length){const[e,n]=t,i=a||o.getZoom();o.flyTo([e,n],i,{duration:1.5})}},[t,a,o]),null}function h(e){let{onLocationSelect:t,onMapClick:a}=e;return(0,i.Po)({click(e){const{lat:n,lng:i}=e.latlng;a&&a(),t&&t({lat:n,lng:i})}}),null}delete m().Icon.Default.prototype._getIconUrl,m().Icon.Default.mergeOptions({iconRetinaUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon-2x.png",iconUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png"});const f=e=>{let{meals:t=[],markers:a=[],onLocationSelect:i,onMarkerClick:c,onMapClick:f,selectedLocation:g,userLocation:x=null,zoom:b=13,height:y="400px",width:v="100%",center:j=[45.4642,9.19]}=e;return(0,n.useEffect)(()=>{"undefined"===typeof window||window.L?console.log("\u2705 [Map] Leaflet caricato correttamente"):console.error("\u274c [Map] Leaflet non \xe8 disponibile")},[]),(0,d.jsx)("div",{style:{width:"100%",height:"100%",position:"relative"},children:(0,d.jsxs)(o.W,{center:j,zoom:b,style:{height:y,width:v,borderRadius:"8px"},whenReady:()=>{console.log("\u2705 [Map] Mappa Leaflet pronta")},whenCreated:e=>{console.log("\u2705 [Map] Istanza mappa creata")},children:[(0,d.jsx)(l.e,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:'\xa9 <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',errorTileUrl:"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='256' height='256'%3E%3Crect fill='%23ddd' width='256' height='256'/%3E%3Ctext fill='%23999' font-family='sans-serif' font-size='18' x='50%25' y='50%25' text-anchor='middle' dominant-baseline='middle'%3EErrore caricamento mappa%3C/text%3E%3C/svg%3E"}),(0,d.jsx)(u,{center:j,zoom:b}),(0,d.jsx)(h,{onLocationSelect:i,onMapClick:f}),g&&(0,d.jsx)(p,{position:g,zoom:b}),x&&(0,d.jsx)(s.p,{position:[x.lat,x.lng],icon:m().icon({iconUrl:"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-blue.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),children:(0,d.jsxs)(r.z,{children:["\ud83d\udccd ",(0,d.jsx)("strong",{children:"La tua posizione"})]})}),g&&(0,d.jsx)(s.p,{position:[g.lat,g.lng],children:(0,d.jsxs)(r.z,{children:["\ud83d\udccd ",(0,d.jsx)("strong",{children:"Posizione selezionata"}),(0,d.jsx)("br",{}),g.address||"".concat(g.lat.toFixed(4),", ").concat(g.lng.toFixed(4))]})}),a.map(e=>(0,d.jsx)(s.p,{position:[e.lat,e.lng],eventHandlers:{click:()=>{c&&c(e.id)}},children:(0,d.jsx)(r.z,{children:(0,d.jsxs)("div",{style:{minWidth:"200px"},children:[(0,d.jsxs)("h3",{style:{margin:"0 0 8px 0",color:"#FF6B35"},children:["\ud83c\udf7d\ufe0f ",e.title||e.name]}),e.price&&(0,d.jsxs)("p",{style:{margin:"4px 0"},children:["\ud83d\udcb0 \u20ac",e.price]}),e.type&&(0,d.jsxs)("p",{style:{margin:"4px 0",color:"#666"},children:["\ud83d\udcc5 ",e.type]})]})})},e.id)),t.map(e=>(0,d.jsx)(s.p,{position:[e.lat,e.lng],eventHandlers:{click:()=>{c&&c(e.id)}},children:(0,d.jsx)(r.z,{children:(0,d.jsxs)("div",{style:{minWidth:"200px"},children:[(0,d.jsxs)("h3",{style:{margin:"0 0 8px 0",color:"#FF6B35"},children:["\ud83c\udf7d\ufe0f ",e.name]}),(0,d.jsxs)("p",{style:{margin:"4px 0"},children:["\ud83d\udccd ",e.restaurant||e.address]}),(0,d.jsxs)("p",{style:{margin:"4px 0"},children:["\ud83d\udc65 ",e.participants||0," partecipanti"]}),(0,d.jsxs)("p",{style:{margin:"4px 0"},children:["\ud83d\udcc5 ",e.date]}),(0,d.jsx)("button",{onClick:()=>window.open("/meal/".concat(e.id),"_blank"),style:{background:"#FF6B35",color:"white",border:"none",padding:"8px 16px",borderRadius:"6px",cursor:"pointer",marginTop:"8px"},children:"Partecipa al TableTalk"})]})})},e.id))]})})}},1072:(e,t,a)=>{a.d(t,{A:()=>p});var n=a(2555),i=a(45),o=a(8139),s=a.n(o),r=a(5043),l=a(7852),c=a(579);const m=["bsPrefix","className","as"],d=r.forwardRef((e,t)=>{let{bsPrefix:a,className:o,as:r="div"}=e,d=(0,i.A)(e,m);const p=(0,l.oU)(a,"row"),u=(0,l.gy)(),h=(0,l.Jm)(),f="".concat(p,"-cols"),g=[];return u.forEach(e=>{const t=d[e];let a;delete d[e],null!=t&&"object"===typeof t?({cols:a}=t):a=t;const n=e!==h?"-".concat(e):"";null!=a&&g.push("".concat(f).concat(n,"-").concat(a))}),(0,c.jsx)(r,(0,n.A)((0,n.A)({ref:t},d),{},{className:s()(o,p,...g)}))});d.displayName="Row";const p=d},7352:(e,t,a)=>{a.d(t,{A:()=>r});a(5043);var n=a(3216),i=a(184);const o="BackButton_backButton__hBNQM";var s=a(579);const r=e=>{let{className:t=""}=e;const a=(0,n.Zp)();return(0,s.jsxs)("button",{onClick:()=>{a(-1)},className:"".concat(o," ").concat(t),children:[(0,s.jsx)(i.QVr,{style:{marginRight:8}}),"Torna indietro"]})}},7806:(e,t,a)=>{a.d(t,{A:()=>F});var n=a(2555),i=a(5043),o=a(8298),s=a(1072),r=a(8602),l=a(4282),c=a(7417),m=a(4117),d=a(5950);const p={form:"MealForm_form__iyuod",formGroup:"MealForm_formGroup__Nagwi",formLabel:"MealForm_formLabel__EuahF",formControl:"MealForm_formControl__QOV2v",dateInputContainer:"MealForm_dateInputContainer__tCElf",dateHelperButton:"MealForm_dateHelperButton__ypazG",formSelect:"MealForm_formSelect__qfqPi",formCheck:"MealForm_formCheck__GCWf7",typeSelector:"MealForm_typeSelector__mfJc5",typeButton:"MealForm_typeButton__KyHCF",active:"MealForm_active__Hpn7f",typeIcon:"MealForm_typeIcon__XJPIu",typeText:"MealForm_typeText__7CnAo",typeDescription:"MealForm_typeDescription__t2zNS",typeInfo:"MealForm_typeInfo__pB1+E",visibilitySelector:"MealForm_visibilitySelector__WKtUp",visibilityButton:"MealForm_visibilityButton__D2Hp1",visibilityIcon:"MealForm_visibilityIcon__FlV5b",visibilityText:"MealForm_visibilityText__dnQrt",visibilityDescription:"MealForm_visibilityDescription__FL8e4",visibilityInfo:"MealForm_visibilityInfo__-fbWG",mapContainer:"MealForm_mapContainer__whBqK",locationInfo:"MealForm_locationInfo__hHdUX",submitButton:"MealForm_submitButton__fUBD0",stickyActions:"MealForm_stickyActions__wBnhW",cancelButton:"MealForm_cancelButton__thg-a",error:"MealForm_error__TbffJ",success:"MealForm_success__pUq4n",loading:"MealForm_loading__6DqYq"};var u,h,f,g=a(5403);!function(e){e.Prompt="PROMPT",e.Camera="CAMERA",e.Photos="PHOTOS"}(u||(u={})),function(e){e.Rear="REAR",e.Front="FRONT"}(h||(h={})),function(e){e.Uri="uri",e.Base64="base64",e.DataUrl="dataUrl"}(f||(f={}));class x extends g.E_{async getPhoto(e){return new Promise(async(t,a)=>{if(e.webUseInput||e.source===u.Photos)this.fileInputExperience(e,t,a);else if(e.source===u.Prompt){let n=document.querySelector("pwa-action-sheet");n||(n=document.createElement("pwa-action-sheet"),document.body.appendChild(n)),n.header=e.promptLabelHeader||"Photo",n.cancelable=!1,n.options=[{title:e.promptLabelPhoto||"From Photos"},{title:e.promptLabelPicture||"Take Picture"}],n.addEventListener("onSelection",async n=>{0===n.detail?this.fileInputExperience(e,t,a):this.cameraExperience(e,t,a)})}else this.cameraExperience(e,t,a)})}async pickImages(e){return new Promise(async(e,t)=>{this.multipleFileInputExperience(e,t)})}async cameraExperience(e,t,a){if(customElements.get("pwa-camera-modal")){const i=document.createElement("pwa-camera-modal");i.facingMode=e.direction===h.Front?"user":"environment",document.body.appendChild(i);try{await i.componentOnReady(),i.addEventListener("onPhoto",async n=>{const o=n.detail;null===o?a(new g.I9("User cancelled photos app")):o instanceof Error?a(o):t(await this._getCameraPhoto(o,e)),i.dismiss(),document.body.removeChild(i)}),i.present()}catch(n){this.fileInputExperience(e,t,a)}}else console.error("Unable to load PWA Element 'pwa-camera-modal'. See the docs: https://capacitorjs.com/docs/web/pwa-elements."),this.fileInputExperience(e,t,a)}fileInputExperience(e,t,a){let n=document.querySelector("#_capacitor-camera-input");const i=()=>{var e;null===(e=n.parentNode)||void 0===e||e.removeChild(n)};n||(n=document.createElement("input"),n.id="_capacitor-camera-input",n.type="file",n.hidden=!0,document.body.appendChild(n),n.addEventListener("change",a=>{const o=n.files[0];let s="jpeg";if("image/png"===o.type?s="png":"image/gif"===o.type&&(s="gif"),"dataUrl"===e.resultType||"base64"===e.resultType){const a=new FileReader;a.addEventListener("load",()=>{if("dataUrl"===e.resultType)t({dataUrl:a.result,format:s});else if("base64"===e.resultType){const e=a.result.split(",")[1];t({base64String:e,format:s})}i()}),a.readAsDataURL(o)}else t({webPath:URL.createObjectURL(o),format:s}),i()}),n.addEventListener("cancel",e=>{a(new g.I9("User cancelled photos app")),i()})),n.accept="image/*",n.capture=!0,e.source===u.Photos||e.source===u.Prompt?n.removeAttribute("capture"):e.direction===h.Front?n.capture="user":e.direction===h.Rear&&(n.capture="environment"),n.click()}multipleFileInputExperience(e,t){let a=document.querySelector("#_capacitor-camera-input-multiple");const n=()=>{var e;null===(e=a.parentNode)||void 0===e||e.removeChild(a)};a||(a=document.createElement("input"),a.id="_capacitor-camera-input-multiple",a.type="file",a.hidden=!0,a.multiple=!0,document.body.appendChild(a),a.addEventListener("change",t=>{const i=[];for(let e=0;e<a.files.length;e++){const t=a.files[e];let n="jpeg";"image/png"===t.type?n="png":"image/gif"===t.type&&(n="gif"),i.push({webPath:URL.createObjectURL(t),format:n})}e({photos:i}),n()}),a.addEventListener("cancel",e=>{t(new g.I9("User cancelled photos app")),n()})),a.accept="image/*",a.click()}_getCameraPhoto(e,t){return new Promise((a,n)=>{const i=new FileReader,o=e.type.split("/")[1];"uri"===t.resultType?a({webPath:URL.createObjectURL(e),format:o,saved:!1}):(i.readAsDataURL(e),i.onloadend=()=>{const e=i.result;"dataUrl"===t.resultType?a({dataUrl:e,format:o,saved:!1}):a({base64String:e.split(",")[1],format:o,saved:!1})},i.onerror=e=>{n(e)})})}async checkPermissions(){if("undefined"===typeof navigator||!navigator.permissions)throw this.unavailable("Permissions API not available in this browser");try{return{camera:(await window.navigator.permissions.query({name:"camera"})).state,photos:"granted"}}catch(e){throw this.unavailable("Camera permissions are not available in this browser")}}async requestPermissions(){throw this.unimplemented("Not implemented on web.")}async pickLimitedLibraryPhotos(){throw this.unavailable("Not implemented on web.")}async getLimitedLibraryPhotos(){throw this.unavailable("Not implemented on web.")}}new x;const b=(0,g.F3)("Camera",{web:()=>new x}),y="TopicInput_topicInputContainer__NfIJd",v="TopicInput_topicTag__HTw1U",j="TopicInput_removeTagButton__sDCPm",A="TopicInput_topicInput__WbbZc",_="TopicInput_inputError__VAq+v",w="TopicInput_hasError__0Xkbf",L="TopicInput_errorMessage__leuM0";var N=a(579);const T=e=>{let{topics:t,setTopics:a,onValidationChange:n}=e;const[o,s]=(0,i.useState)(""),[r,l]=(0,i.useState)("");(0,i.useEffect)(()=>{c()},[]),(0,i.useEffect)(()=>{if(n){const e=t.length>0&&t.every(e=>{const t=e.trim();return t.length>=2&&t.length<=50&&!/^\s+$/.test(t)});n(e)}},[t,n]);const c=()=>{if(!Array.isArray(t)||0===t.length)return;const e=t.filter(e=>{if("string"!==typeof e)return!1;const t=e.trim();return t.length>=2&&t.length<=50&&!/^\s+$/.test(t)&&!/^[^\w\s]+$/.test(t)&&/^[\w\s\u00C0-\u017F]+$/i.test(t)});e.length!==t.length&&(console.log("\ud83e\uddf9 [TopicInput] Puliti ".concat(t.length-e.length," argomenti non validi")),a(e))};return(0,N.jsxs)("div",{className:"".concat(y," ").concat(r?w:""),children:[t.map((e,n)=>(0,N.jsxs)("div",{className:v,children:[e,(0,N.jsx)("button",{type:"button",className:j,onClick:()=>{return n=e,void a(t.filter(e=>e!==n));var n},children:"\xd7"})]},n)),(0,N.jsx)("input",{type:"text",value:o,onChange:e=>{s(e.target.value),r&&l("")},onKeyDown:e=>{if("Enter"===e.key||","===e.key){e.preventDefault();const n=(e=>{if("string"!==typeof e)return{isValid:!1,error:"L'argomento deve essere una stringa valida"};const a=e.trim();return a.length<2?{isValid:!1,error:"L'argomento deve essere di almeno 2 caratteri"}:a.length>50?{isValid:!1,error:"L'argomento non pu\xf2 superare i 50 caratteri"}:t.some(e=>e.toLowerCase()===a.toLowerCase())?{isValid:!1,error:"Questo argomento \xe8 gi\xe0 presente"}:/^\s+$/.test(a)?{isValid:!1,error:"L'argomento non pu\xf2 contenere solo spazi"}:/^[\w\s\u00C0-\u017F]+$/i.test(a)?{isValid:!0,topic:a}:{isValid:!1,error:"L'argomento pu\xf2 contenere solo lettere, numeri e spazi"}})(o);if(n.isValid)if(t.length<5)a([...t,n.topic]),s(""),l("");else{const e="Limite massimo di 5 argomenti raggiunto";console.warn("\u26a0\ufe0f [TopicInput] ".concat(e)),l(e)}else console.warn("\u26a0\ufe0f [TopicInput] Argomento non valido: ".concat(n.error)),l(n.error)}},placeholder:t.length<5?"Aggiungi un argomento...":"Massimo 5 argomenti",className:"".concat(A," ").concat(r?_:""),disabled:t.length>=5}),r&&(0,N.jsxs)("div",{className:L,children:["\u26a0\ufe0f ",r]})]})};var C=a(549),S=a(8993);const E=["Italiano","English","Espa\xf1ol","Fran\xe7ais","Deutsch","\u4e2d\u6587","\u0627\u0644\u0639\u0631\u0628\u064a\u0629"],F=e=>{var t;let{initialData:a,onSubmit:h,onCancel:x,isLoading:y,isSubmitting:v,submitButtonText:j}=e;const{t:A}=(0,m.Bd)(),_=[{value:30,label:A("meals.form.durationOptions.30min")},{value:60,label:A("meals.form.durationOptions.1hour")},{value:90,label:A("meals.form.durationOptions.1hour30")},{value:120,label:A("meals.form.durationOptions.2hours")},{value:150,label:A("meals.form.durationOptions.2hours30")},{value:180,label:A("meals.form.durationOptions.3hours")}],[w,L]=(0,i.useState)((()=>{const e=new Date,t=new Date(e.getTime()+36e5),a=t.getFullYear(),n=String(t.getMonth()+1).padStart(2,"0"),i=String(t.getDate()).padStart(2,"0"),o=String(t.getHours()).padStart(2,"0"),s=String(t.getMinutes()).padStart(2,"0");return{title:"",description:"",mealType:"virtual",type:"lunch",date:"".concat(a,"-").concat(n,"-").concat(i,"T").concat(o,":").concat(s),duration:60,maxParticipants:2,language:"English",topics:[],location:null,isPublic:!0,estimatedCost:""}})()),[F,M]=(0,i.useState)(null),[P,I]=(0,i.useState)(null),[k,z]=(0,i.useState)(""),[D,R]=(0,i.useState)({}),[U,B]=(0,i.useState)(null);(0,i.useEffect)(()=>{w.location&&w.location.coordinates&&B({lat:w.location.coordinates[1],lng:w.location.coordinates[0],address:w.location.address})},[w.location]);const O=(e,t)=>{switch(e){case"title":if(!t.trim())return A("meals.form.titleRequired");if(t.trim().length<5)return A("meals.form.titleMinLength");if(t.trim().length>50)return A("meals.form.titleMaxLength");if((0,S.$J)(t))return"Il titolo contiene contenuto non permesso (HTML/JavaScript)";break;case"description":if(!t.trim())return A("meals.form.descriptionRequired");if(t.trim().length<10)return A("meals.form.descriptionMinLength");if(t.trim().length>1e3)return A("meals.form.descriptionMaxLength");if((0,S.$J)(t))return"La descrizione contiene contenuto non permesso (HTML/JavaScript)";break;case"date":if(!t)return A("meals.form.dateRequired");const e=new Date(t),a=new Date,n=3e5;if(e<new Date(a.getTime()-n))return A("meals.form.datePast")||"La data deve essere nel futuro";if(e>new Date(a.getFullYear()+1,a.getMonth(),a.getDate()))return A("meals.form.dateTooFar")||"La data non pu\xf2 essere pi\xf9 di un anno nel futuro";break;case"maxParticipants":if(!t||t<2)return A("meals.form.maxParticipantsMin");if(t>10)return A("meals.form.maxParticipantsMax");break;case"topics":default:return"";case"location":if("physical"===w.mealType&&!t)return A("meals.form.locationRequired")}return""},q=e=>{const{name:t,value:a}=e.target;if("date"===t&&a){const e=new Date(a),t=new Date,i=3e5;if(e<new Date(t.getTime()-i))return console.warn("\u26a0\ufe0f [MealForm] Data nel passato selezionata, reset campo"),L(e=>(0,n.A)((0,n.A)({},e),{},{date:""})),void R(e=>(0,n.A)((0,n.A)({},e),{},{date:A("meals.form.datePast")||"La data deve essere nel futuro"}))}L(e=>(0,n.A)((0,n.A)({},e),{},{[t]:a}));const i=O(t,a);R(e=>(0,n.A)((0,n.A)({},e),{},{[t]:i}))},G=e=>{const{name:t,value:a}=e.target,i=O(t,a);R(e=>(0,n.A)((0,n.A)({},e),{},{[t]:i}))},W=async e=>{const t=e.target.value.trim();if(!t||t.length<3)return;R(e=>(0,n.A)((0,n.A)({},e),{},{location:"Ricerca indirizzo..."}));const a=await(async e=>{if(!e||e.trim().length<3)return null;try{const t=await fetch("https://nominatim.openstreetmap.org/search?format=json&q=".concat(encodeURIComponent(e),"&limit=1&addressdetails=1"),{headers:{"User-Agent":"TableTalk App"}}),a=await t.json();if(a&&a.length>0){const t=a[0];return{lat:parseFloat(t.lat),lng:parseFloat(t.lon),address:t.display_name||e}}return null}catch(t){return console.error("Errore geocodifica indirizzo:",t),null}})(t);a?(B(a),L(e=>(0,n.A)((0,n.A)({},e),{},{location:{address:a.address,coordinates:[a.lng,a.lat]}})),R(e=>(0,n.A)((0,n.A)({},e),{},{location:null}))):R(e=>(0,n.A)((0,n.A)({},e),{},{location:"Indirizzo non trovato. Prova a selezionarlo dalla mappa."}))},H=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"image.jpg";if(e.type&&e.type.startsWith("image/"))if(e.size>10485760)alert("Il file \xe8 troppo grande. Massimo 10MB.");else try{const n=new FileReader;n.onload=e=>{I(e.target.result)},n.readAsDataURL(e);let i=e;if(e.size>4194304){const a=await J(e,{maxWidth:1600,quality:.7});i=new File([a],t,{type:"image/jpeg"})}M(i);try{const e=await $(i);"string"===typeof e&&z(e)}catch(a){}console.log("\ud83d\udcc1 File selezionato:",i.name,i.size)}catch(n){console.error("Errore elaborazione file",n)}else alert("Seleziona solo file immagine")},V=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:u.Photos;try{const t=await b.checkPermissions();if("denied"===t.camera||"denied"===t.photos){const e=await b.requestPermissions({permissions:["camera","photos"]});if("denied"===e.camera||"denied"===e.photos)return void alert("I permessi per fotocamera e libreria foto sono necessari per caricare le immagini.")}const a=await b.getPhoto({quality:90,allowEditing:!1,resultType:f.DataUrl,source:e,width:1600,height:1600});if(a&&a.dataUrl){const e=await fetch(a.dataUrl),t=await e.blob(),n=new File([t],"photo_".concat(Date.now(),".jpg"),{type:"image/jpeg"});await H(n,n.name)}}catch(t){console.error("Errore selezione foto:",t),alert("Errore durante la selezione della foto. Riprova.")}},J=async function(e){let{maxWidth:t=1600,quality:a=.7}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{const n=await createImageBitmap(e),i=Math.min(1,t/n.width),o=Math.round(n.width*i),s=Math.round(n.height*i),r=document.createElement("canvas");r.width=o,r.height=s;r.getContext("2d").drawImage(n,0,0,o,s);const l=r.toDataURL("image/jpeg",a),c=await fetch(l);return await c.blob()}catch(n){return e}},$=e=>new Promise((t,a)=>{try{const n=new FileReader;n.onloadend=()=>t(n.result),n.onerror=a,n.readAsDataURL(e)}catch(n){a(n)}});return(0,N.jsxs)(o.A,{onSubmit:e=>{if(e.preventDefault(),w.date){const e=new Date(w.date),t=new Date,a=3e5;if(e<new Date(t.getTime()-a))return console.warn("\u26a0\ufe0f [MealForm] Submit bloccato: data nel passato rilevata"),void R(e=>(0,n.A)((0,n.A)({},e),{},{date:A("meals.form.datePast")||"La data deve essere nel futuro"}))}const t={};if(Object.keys(w).forEach(e=>{const a=O(e,w[e]);a&&(t[e]=a)}),Object.keys(t).length>0)return void R(t);const a=(0,S.nB)(w);const i=new FormData,o=(0,n.A)({},a);o.date&&(o.date=new Date(o.date).toISOString());for(const n in o)"topics"===n&&Array.isArray(o[n])?o[n].forEach(e=>i.append("topics",e)):"location"===n&&o[n]?i.append("location",JSON.stringify(o[n])):"location"===n&&"physical"!==w.mealType||i.append(n,o[n]);F&&(i.append("image",F),k&&i.append("imageBase64",k),P&&i.append("imageLocalUri",P)),h(i)},className:p.form,children:[(0,N.jsxs)("div",{className:p.formGroup,children:[(0,N.jsx)("label",{className:p.formLabel,children:A("meals.form.typeLabel")}),(0,N.jsxs)("div",{className:p.typeSelector,children:[(0,N.jsxs)("button",{type:"button",className:"".concat(p.typeButton," ").concat("virtual"===w.mealType?p.active:""),onClick:()=>L((0,n.A)((0,n.A)({},w),{},{mealType:"virtual",location:null})),children:[(0,N.jsx)("span",{className:p.typeIcon,children:"\ud83c\udfa5"}),(0,N.jsx)("span",{className:p.typeText,children:A("meals.form.virtualType")}),(0,N.jsx)("small",{className:p.typeDescription,children:A("meals.form.virtualDescription")})]}),(0,N.jsxs)("button",{type:"button",className:"".concat(p.typeButton," ").concat("physical"===w.mealType?p.active:""),onClick:()=>L((0,n.A)((0,n.A)({},w),{},{mealType:"physical"})),children:[(0,N.jsx)("span",{className:p.typeIcon,children:"\ud83d\udccd"}),(0,N.jsx)("span",{className:p.typeText,children:A("meals.form.physicalType")}),(0,N.jsx)("small",{className:p.typeDescription,children:A("meals.form.physicalDescription")})]})]}),(0,N.jsx)("div",{className:p.typeInfo,children:"virtual"===w.mealType?A("meals.form.virtualInfo"):A("meals.form.physicalInfo")})]}),"physical"===w.mealType&&(0,N.jsxs)("div",{className:p.formGroup,children:[(0,N.jsx)("label",{className:p.formLabel,children:A("meals.form.visibilityLabel")}),(0,N.jsxs)("div",{className:p.visibilitySelector,children:[(0,N.jsxs)("button",{type:"button",className:"".concat(p.visibilityButton," ").concat(w.isPublic?p.active:""),onClick:()=>L((0,n.A)((0,n.A)({},w),{},{isPublic:!0})),children:[(0,N.jsx)("span",{className:p.visibilityIcon,children:"\ud83c\udf0d"}),(0,N.jsx)("span",{className:p.visibilityText,children:A("meals.form.publicVisibility")}),(0,N.jsx)("small",{className:p.visibilityDescription,children:A("meals.form.publicDescription")})]}),(0,N.jsxs)("button",{type:"button",className:"".concat(p.visibilityButton," ").concat(w.isPublic?"":p.active),onClick:()=>L((0,n.A)((0,n.A)({},w),{},{isPublic:!1})),children:[(0,N.jsx)("span",{className:p.visibilityIcon,children:"\ud83d\udd12"}),(0,N.jsx)("span",{className:p.visibilityText,children:A("meals.form.privateVisibility")}),(0,N.jsx)("small",{className:p.visibilityDescription,children:A("meals.form.privateDescription")})]})]}),(0,N.jsx)("div",{className:p.visibilityInfo,children:w.isPublic?A("meals.form.publicInfo"):A("meals.form.privateInfo")})]}),(0,N.jsxs)(o.A.Group,{className:"mb-3",children:[(0,N.jsx)(o.A.Label,{className:p.formLabel,children:A("meals.form.titleLabel")}),(0,N.jsx)(o.A.Control,{className:"".concat(p.formControl," ").concat(D.title?"is-invalid":""),type:"text",name:"title",value:w.title,onChange:q,onBlur:G,required:!0}),D.title&&(0,N.jsx)("div",{className:"invalid-feedback",children:D.title})]}),(0,N.jsxs)(o.A.Group,{className:"mb-3",children:[(0,N.jsx)(o.A.Label,{className:p.formLabel,children:A("meals.form.descriptionLabel")}),(0,N.jsx)(o.A.Control,{className:"".concat(p.formControl," ").concat(D.description?"is-invalid":""),as:"textarea",rows:3,name:"description",value:w.description,onChange:q,onBlur:G,required:!0}),D.description&&(0,N.jsx)("div",{className:"invalid-feedback",children:D.description})]}),(0,N.jsxs)(s.A,{className:"mb-3",children:[(0,N.jsx)(r.A,{md:6,children:(0,N.jsxs)(o.A.Group,{children:[(0,N.jsx)(o.A.Label,{className:p.formLabel,children:A("meals.form.categoryLabel")}),(0,N.jsxs)(o.A.Select,{className:p.formSelect,name:"type",value:w.type,onChange:q,required:!0,children:[(0,N.jsx)("option",{value:"",disabled:!0,children:A("meals.form.selectCategory")}),d.oD.map(e=>(0,N.jsx)("option",{value:e.value,children:e.label},e.value))]})]})}),(0,N.jsx)(r.A,{md:6,children:(0,N.jsxs)(o.A.Group,{children:[(0,N.jsx)(o.A.Label,{className:p.formLabel,children:A("meals.form.maxParticipantsLabel")}),(0,N.jsx)(o.A.Control,{className:"".concat(p.formControl," ").concat(D.maxParticipants?"is-invalid":""),type:"number",name:"maxParticipants",value:w.maxParticipants,onChange:q,onBlur:G,required:!0,min:"2",max:"10"}),D.maxParticipants&&(0,N.jsx)("div",{className:"invalid-feedback",children:D.maxParticipants})]})})]}),(0,N.jsxs)(s.A,{className:"mb-3",children:[(0,N.jsx)(r.A,{xs:12,md:6,children:(0,N.jsxs)(o.A.Group,{children:[(0,N.jsx)(o.A.Label,{className:p.formLabel,children:A("meals.form.languageLabel")}),(0,N.jsx)(o.A.Select,{className:p.formSelect,name:"language",value:w.language,onChange:q,required:!0,children:E.map(e=>(0,N.jsx)("option",{value:e,children:e},e))})]})}),(0,N.jsx)(r.A,{xs:12,md:6,children:(0,N.jsxs)(o.A.Group,{children:[(0,N.jsx)(o.A.Label,{className:p.formLabel,children:A("meals.form.durationLabel")}),(0,N.jsx)(o.A.Select,{className:p.formSelect,name:"duration",value:w.duration,onChange:q,required:!0,children:_.map(e=>(0,N.jsx)("option",{value:e.value,children:e.label},e.value))})]})})]}),"physical"===w.mealType&&(0,N.jsx)(s.A,{className:"mb-3",children:(0,N.jsx)(r.A,{md:6,children:(0,N.jsxs)(o.A.Group,{children:[(0,N.jsx)(o.A.Label,{className:p.formLabel,children:A("meals.form.priceLabel")||"Prezzo Stimato (\u20ac)"}),(0,N.jsxs)("div",{className:"input-group",children:[(0,N.jsx)("span",{className:"input-group-text",children:"\u20ac"}),(0,N.jsx)(o.A.Control,{className:p.formControl,type:"number",name:"estimatedCost",value:w.estimatedCost,onChange:q,placeholder:"Es. 25",min:"0"})]}),(0,N.jsx)(o.A.Text,{className:"text-muted",children:"Costo medio a persona (solo indicativo)"})]})})}),(0,N.jsxs)(s.A,{className:"mb-3",children:[(0,N.jsx)(r.A,{xs:12,md:6,children:(0,N.jsxs)(o.A.Group,{children:[(0,N.jsx)(o.A.Label,{className:p.formLabel,children:A("meals.form.dateLabel")}),(0,N.jsxs)("div",{className:p.dateInputContainer,children:[(0,N.jsx)(o.A.Control,{className:"".concat(p.formControl," ").concat(D.date?"is-invalid":""),type:"datetime-local",name:"date",value:w.date,min:(()=>{const e=new Date,t=new Date(e.getTime()-3e5),a=t.getFullYear(),n=String(t.getMonth()+1).padStart(2,"0"),i=String(t.getDate()).padStart(2,"0"),o=String(t.getHours()).padStart(2,"0"),s=String(t.getMinutes()).padStart(2,"0");return"".concat(a,"-").concat(n,"-").concat(i,"T").concat(o,":").concat(s)})(),onChange:q,onBlur:G,required:!0}),(0,N.jsx)("button",{type:"button",className:p.dateHelperButton,onClick:()=>{const e=new Date,t=new Date(e.getTime()+36e5),a=t.getFullYear(),i=String(t.getMonth()+1).padStart(2,"0"),o=String(t.getDate()).padStart(2,"0"),s=String(t.getHours()).padStart(2,"0"),r=String(t.getMinutes()).padStart(2,"0"),l="".concat(a,"-").concat(i,"-").concat(o,"T").concat(s,":").concat(r);L(e=>(0,n.A)((0,n.A)({},e),{},{date:l})),R(e=>(0,n.A)((0,n.A)({},e),{},{date:""}))},title:"Suggerisci data valida (1 ora da ora)",children:"\ud83d\udd50"})]}),D.date&&(0,N.jsx)("div",{className:"invalid-feedback",children:D.date}),(0,N.jsx)(o.A.Text,{className:"text-muted",children:"\ud83d\udcc5 Seleziona una data e ora nel futuro"})]})}),(0,N.jsx)(r.A,{xs:12,md:6,children:"physical"===w.mealType&&(0,N.jsxs)(o.A.Group,{children:[(0,N.jsx)(o.A.Label,{className:p.formLabel,children:A("meals.form.addressLabel")}),(0,N.jsx)(o.A.Control,{className:"".concat(p.formControl," ").concat(D.location&&"Ricerca indirizzo..."!==D.location?"is-invalid":""),type:"text",name:"address",value:(null===(t=w.location)||void 0===t?void 0:t.address)||"",onChange:async e=>{const t=e.target.value;if(L(e=>(0,n.A)((0,n.A)({},e),{},{location:e.location?(0,n.A)((0,n.A)({},e.location),{},{address:t}):{address:t,coordinates:null}})),!t||0===t.trim().length)return B(null),void L(e=>(0,n.A)((0,n.A)({},e),{},{location:null}))},onBlur:W,onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),W(e))},placeholder:A("meals.form.addressPlaceholder")}),D.location&&(0,N.jsx)("div",{className:"Ricerca indirizzo..."===D.location?"text-info":"invalid-feedback",children:D.location}),(0,N.jsx)(o.A.Text,{className:"text-muted",children:"\ud83d\udccd Inserisci l'indirizzo manualmente o selezionalo dalla mappa sottostante"})]})})]}),"physical"===w.mealType&&(0,N.jsxs)("div",{className:p.formGroup,children:[(0,N.jsx)("label",{children:"\ud83d\udccd Seleziona posizione del pasto:"}),(0,N.jsx)(C.A,{selectedLocation:U,onLocationSelect:async e=>{let t=e.address;if(!t&&e.lat&&e.lng)try{const a=await fetch("https://nominatim.openstreetmap.org/reverse?format=json&lat=".concat(e.lat,"&lon=").concat(e.lng,"&addressdetails=1"),{headers:{"User-Agent":"TableTalk App"}}),n=await a.json();n&&n.display_name&&(t=n.display_name)}catch(i){console.error("Errore reverse geocoding:",i)}const a=t||"".concat(e.lat.toFixed(4),", ").concat(e.lng.toFixed(4));B((0,n.A)((0,n.A)({},e),{},{address:a})),L(t=>(0,n.A)((0,n.A)({},t),{},{location:{address:a,coordinates:[e.lng,e.lat]}})),R(e=>(0,n.A)((0,n.A)({},e),{},{location:null}))},height:"300px",center:U?[U.lat,U.lng]:w.location&&w.location.coordinates?[w.location.coordinates[1],w.location.coordinates[0]]:[45.4642,9.19]}),U&&(0,N.jsxs)("div",{className:"selected-location-info",style:{marginTop:"10px",padding:"10px",backgroundColor:"#f8f9fa",borderRadius:"8px",border:"1px solid #dee2e6"},children:["\u2705 ",(0,N.jsx)("strong",{children:"Posizione selezionata:"}),(0,N.jsx)("br",{}),(0,N.jsx)("span",{style:{fontSize:"14px",color:"#666"},children:U.address||"Lat: ".concat(U.lat.toFixed(4),", Lng: ").concat(U.lng.toFixed(4))})]})]}),(0,N.jsxs)(o.A.Group,{className:"mb-3",children:[(0,N.jsx)(o.A.Label,{className:p.formLabel,children:A("meals.form.topicsLabel")}),(0,N.jsx)(T,{topics:w.topics,setTopics:e=>{L(t=>(0,n.A)((0,n.A)({},t),{},{topics:e}));const t=O("topics",e);R(e=>(0,n.A)((0,n.A)({},e),{},{topics:t}))}}),D.topics&&(0,N.jsx)("div",{className:"invalid-feedback d-block",children:D.topics}),(0,N.jsx)(o.A.Text,{children:A("meals.form.topicsHelp")})]}),(0,N.jsxs)(o.A.Group,{className:"mb-3",children:[(0,N.jsx)(o.A.Label,{children:A("meals.form.coverImageLabel")}),P&&(0,N.jsx)("img",{src:P,alt:A("meals.form.coverImageAlt"),className:p.imagePreview}),g.Capacitor.isNativePlatform()?(0,N.jsxs)("div",{className:"mt-2",children:[(0,N.jsxs)("div",{className:"d-flex gap-2 flex-wrap",children:[(0,N.jsx)(l.A,{variant:"outline-primary",onClick:()=>V(u.Camera),style:{fontSize:"0.9em"},children:"\ud83d\udcf7 Fotocamera"}),(0,N.jsx)(l.A,{variant:"outline-primary",onClick:()=>V(u.Photos),style:{fontSize:"0.9em"},children:"\ud83d\uddbc\ufe0f Libreria Foto"})]}),(0,N.jsx)(o.A.Text,{className:"text-muted d-block mt-2",children:"Seleziona una foto dalla fotocamera o dalla libreria (max 10MB)"})]}):(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)(o.A.Control,{type:"file",accept:"image/*",onChange:async e=>{const t=e.target.files[0];t&&await H(t)},className:"mt-2",style:{fontSize:"0.9em"}}),(0,N.jsx)(o.A.Text,{className:"text-muted",children:"Seleziona un'immagine dal tuo dispositivo (max 10MB)"})]}),F&&(0,N.jsxs)("div",{className:"mt-2 p-2 bg-light rounded",style:{fontSize:"0.9em"},children:[(0,N.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,N.jsx)("span",{children:"\ud83d\udcf7 Immagine selezionata"}),(0,N.jsxs)("small",{className:"text-muted",children:[F.name," (",(F.size/1024/1024).toFixed(2)," MB)"]})]}),(0,N.jsx)("small",{className:"text-muted d-block mt-1",children:"L'immagine verr\xe0 caricata insieme al pasto"})]})]}),(0,N.jsx)("div",{className:p.stickyActions,children:(0,N.jsx)(l.A,{variant:"primary",type:"submit",className:p.submitButton,disabled:y||v,children:y||v?(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)(c.A,{as:"span",animation:"border",size:"sm"}),(0,N.jsxs)("span",{children:[" ",A(v?"meals.form.saving":"meals.form.loading")]})]}):j||A("forms.save")})})]})}},8993:(e,t,a)=>{a.d(t,{$J:()=>l,nB:()=>c});var n=a(2555),i=a(7977);const o={ALLOWED_TAGS:[],ALLOWED_ATTR:[],ALLOW_DATA_ATTR:!1,ALLOW_UNKNOWN_PROTOCOLS:!1,RETURN_DOM:!1,RETURN_DOM_FRAGMENT:!1,RETURN_TRUSTED_TYPE:!1,KEEP_CONTENT:!1,IN_PLACE:!1,SANITIZE_DOM:!0,WHOLE_DOCUMENT:!1,RETURN_DOM_IMPORT:!1,FORCE_BODY:!1,SANITIZE_NAMED_PROPS:!1,ALLOWED_URI_REGEXP:/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i},s=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e||"string"!==typeof e)return"";try{const a=t?(0,n.A)((0,n.A)({},o),{},{ALLOWED_TAGS:["b","i","em","strong","u"],ALLOWED_ATTR:[]}):o;return i.A.sanitize(e,a)}catch(a){return console.error("\u274c [SanitizationService] Errore sanitizzazione:",a),""}},r=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!e||"object"!==typeof e)return e;const i=(0,n.A)({},e);return(t.length>0?t:Object.keys(e).filter(t=>"string"===typeof e[t])).forEach(e=>{i[e]&&"string"===typeof i[e]&&(i[e]=s(i[e],a))}),i},l=e=>{if(!e||"string"!==typeof e)return!1;return[/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,/<iframe\b[^<]*(?:(?!<\/iframe>)<[^<]*)*<\/iframe>/gi,/<object\b[^<]*(?:(?!<\/object>)<[^<]*)*<\/object>/gi,/<embed\b[^<]*(?:(?!<\/embed>)<[^<]*)*<\/embed>/gi,/javascript:/gi,/vbscript:/gi,/data:/gi,/on\w+\s*=/gi,/<.*>/g].some(t=>t.test(e))},c=e=>r(e,["title","description","language","topics"],!1)}}]);
//# sourceMappingURL=740.cf38183f.chunk.js.map