"use strict";(self.webpackChunktable_talk_client=self.webpackChunktable_talk_client||[]).push([[903],{549:(e,a,t)=>{t.d(a,{A:()=>g});var s=t(5043),n=t(9896),i=t(9419),l=t(6036),o=t(3318),c=t(2023),r=t(228),d=t.n(r),m=(t(6433),t(579));function h(e){let{position:a,zoom:t}=e;const i=(0,n.ko)();return(0,s.useEffect)(()=>{if(a&&a.lat&&a.lng){const e=t||i.getZoom();i.flyTo([a.lat,a.lng],e,{duration:1.5})}},[null===a||void 0===a?void 0:a.lat,null===a||void 0===a?void 0:a.lng,t,i]),null}function p(e){let{center:a,zoom:t}=e;const i=(0,n.ko)();return(0,s.useEffect)(()=>{if(a&&Array.isArray(a)&&2===a.length){const[e,s]=a,n=t||i.getZoom();i.flyTo([e,s],n,{duration:1.5})}},[a,t,i]),null}function x(e){let{onLocationSelect:a,onMapClick:t}=e;return(0,n.Po)({click(e){const{lat:s,lng:n}=e.latlng;t&&t(),a&&a({lat:s,lng:n})}}),null}delete d().Icon.Default.prototype._getIconUrl,d().Icon.Default.mergeOptions({iconRetinaUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon-2x.png",iconUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png"});const g=e=>{let{meals:a=[],markers:t=[],onLocationSelect:n,onMarkerClick:r,onMapClick:g,selectedLocation:j,userLocation:u=null,zoom:f=13,height:v="400px",width:b="100%",center:w=[45.4642,9.19]}=e;return(0,s.useEffect)(()=>{"undefined"===typeof window||window.L?console.log("\u2705 [Map] Leaflet caricato correttamente"):console.error("\u274c [Map] Leaflet non \xe8 disponibile")},[]),(0,m.jsx)("div",{style:{width:"100%",height:"100%",position:"relative"},children:(0,m.jsxs)(i.W,{center:w,zoom:f,style:{height:v,width:b,borderRadius:"8px"},whenReady:()=>{console.log("\u2705 [Map] Mappa Leaflet pronta")},whenCreated:e=>{console.log("\u2705 [Map] Istanza mappa creata")},children:[(0,m.jsx)(c.e,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:'\xa9 <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',errorTileUrl:"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='256' height='256'%3E%3Crect fill='%23ddd' width='256' height='256'/%3E%3Ctext fill='%23999' font-family='sans-serif' font-size='18' x='50%25' y='50%25' text-anchor='middle' dominant-baseline='middle'%3EErrore caricamento mappa%3C/text%3E%3C/svg%3E"}),(0,m.jsx)(p,{center:w,zoom:f}),(0,m.jsx)(x,{onLocationSelect:n,onMapClick:g}),j&&(0,m.jsx)(h,{position:j,zoom:f}),u&&(0,m.jsx)(l.p,{position:[u.lat,u.lng],icon:d().icon({iconUrl:"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-blue.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),children:(0,m.jsxs)(o.z,{children:["\ud83d\udccd ",(0,m.jsx)("strong",{children:"La tua posizione"})]})}),j&&(0,m.jsx)(l.p,{position:[j.lat,j.lng],children:(0,m.jsxs)(o.z,{children:["\ud83d\udccd ",(0,m.jsx)("strong",{children:"Posizione selezionata"}),(0,m.jsx)("br",{}),j.address||"".concat(j.lat.toFixed(4),", ").concat(j.lng.toFixed(4))]})}),t.map(e=>(0,m.jsx)(l.p,{position:[e.lat,e.lng],eventHandlers:{click:()=>{r&&r(e.id)}},children:(0,m.jsx)(o.z,{children:(0,m.jsxs)("div",{style:{minWidth:"200px"},children:[(0,m.jsxs)("h3",{style:{margin:"0 0 8px 0",color:"#FF6B35"},children:["\ud83c\udf7d\ufe0f ",e.title||e.name]}),e.price&&(0,m.jsxs)("p",{style:{margin:"4px 0"},children:["\ud83d\udcb0 \u20ac",e.price]}),e.type&&(0,m.jsxs)("p",{style:{margin:"4px 0",color:"#666"},children:["\ud83d\udcc5 ",e.type]})]})})},e.id)),a.map(e=>(0,m.jsx)(l.p,{position:[e.lat,e.lng],eventHandlers:{click:()=>{r&&r(e.id)}},children:(0,m.jsx)(o.z,{children:(0,m.jsxs)("div",{style:{minWidth:"200px"},children:[(0,m.jsxs)("h3",{style:{margin:"0 0 8px 0",color:"#FF6B35"},children:["\ud83c\udf7d\ufe0f ",e.name]}),(0,m.jsxs)("p",{style:{margin:"4px 0"},children:["\ud83d\udccd ",e.restaurant||e.address]}),(0,m.jsxs)("p",{style:{margin:"4px 0"},children:["\ud83d\udc65 ",e.participants||0," partecipanti"]}),(0,m.jsxs)("p",{style:{margin:"4px 0"},children:["\ud83d\udcc5 ",e.date]}),(0,m.jsx)("button",{onClick:()=>window.open("/meal/".concat(e.id),"_blank"),style:{background:"#FF6B35",color:"white",border:"none",padding:"8px 16px",borderRadius:"6px",cursor:"pointer",marginTop:"8px"},children:"Partecipa al TableTalk"})]})})},e.id))]})})}},1072:(e,a,t)=>{t.d(a,{A:()=>h});var s=t(2555),n=t(45),i=t(8139),l=t.n(i),o=t(5043),c=t(7852),r=t(579);const d=["bsPrefix","className","as"],m=o.forwardRef((e,a)=>{let{bsPrefix:t,className:i,as:o="div"}=e,m=(0,n.A)(e,d);const h=(0,c.oU)(t,"row"),p=(0,c.gy)(),x=(0,c.Jm)(),g="".concat(h,"-cols"),j=[];return p.forEach(e=>{const a=m[e];let t;delete m[e],null!=a&&"object"===typeof a?({cols:t}=a):t=a;const s=e!==x?"-".concat(e):"";null!=t&&j.push("".concat(g).concat(s,"-").concat(t))}),(0,r.jsx)(o,(0,s.A)((0,s.A)({ref:a},m),{},{className:l()(i,h,...j)}))});m.displayName="Row";const h=m},3519:(e,a,t)=>{t.d(a,{A:()=>h});var s=t(2555),n=t(45),i=t(8139),l=t.n(i),o=t(5043),c=t(7852),r=t(579);const d=["bsPrefix","fluid","as","className"],m=o.forwardRef((e,a)=>{let{bsPrefix:t,fluid:i=!1,as:o="div",className:m}=e,h=(0,n.A)(e,d);const p=(0,c.oU)(t,"container"),x="string"===typeof i?"-".concat(i):"-fluid";return(0,r.jsx)(o,(0,s.A)((0,s.A)({ref:a},h),{},{className:l()(m,i?"".concat(p).concat(x):p)}))});m.displayName="Container";const h=m},3903:(e,a,t)=>{t.r(a),t.d(a,{default:()=>k});var s=t(5043),n=t(3216),i=t(7417),l=t(3519),o=t(1719),c=t(4063),r=t(1072),d=t(8602),m=t(4282),h=t(4117),p=t(3401),x=t(184),g=t(2179),j=t(5016),u=t(5950),f=t(549),v=t(7352),b=t(9926);const w="JoinMealButton_joinButton__6Iq+8";var _=t(579);const N=e=>{let{mealId:a,onSuccess:t}=e;const{joinMeal:s,loading:n}=(0,b.w)();return(0,_.jsx)(m.A,{className:w,onClick:async()=>{try{const e=await s(a);e&&t&&t(e)}catch(e){console.error("Fallimento joinMeal nel componente:",e)}},disabled:n,children:n?(0,_.jsxs)(_.Fragment,{children:[(0,_.jsx)(i.A,{as:"span",animation:"border",size:"sm",role:"status","aria-hidden":"true"}),(0,_.jsx)("span",{children:" Attendi..."})]}):"Unisciti al TableTalk\xae"})};var y=t(6229);const A={pageContainer:"MealDetailPage_pageContainer__rTQhF",heroImage:"MealDetailPage_heroImage__Qwr+O",overlay:"MealDetailPage_overlay__nDA0r",title:"MealDetailPage_title__WmRuQ",contentContainer:"MealDetailPage_contentContainer__sAwLx",card:"MealDetailPage_card__PBjFk",actionCard:"MealDetailPage_actionCard__jOaaO",hostInfo:"MealDetailPage_hostInfo__21qzD",hostAvatar:"MealDetailPage_hostAvatar__iOzJc",infoGrid:"MealDetailPage_infoGrid__y0e5k",infoItem:"MealDetailPage_infoItem__K86Ch",icon:"MealDetailPage_icon__a8EpR",description:"MealDetailPage_description__0Zl80",topicsContainer:"MealDetailPage_topicsContainer__uKoCV",avatarList:"MealDetailPage_avatarList__LrcPT",miniAvatar:"MealDetailPage_miniAvatar__sXV9q"},k=()=>{var e,a,t,b,w,k,C,P,M;const{t:D}=(0,h.Bd)(),{mealId:I}=(0,n.g)(),z=(0,n.Zp)(),{user:L}=(0,j.A)(),[T,S]=(0,s.useState)(null),[U,E]=(0,s.useState)(!0),[R,B]=(0,s.useState)(null),[F,H]=(0,s.useState)(!1),O=(0,s.useCallback)(async()=>{try{E(!0);const e=await g.A.getMealById(I);S(e.data||e)}catch(e){console.error("Errore caricamento pasto:",e),B(D("meals.detail.loadError")||"Impossibile caricare il pasto.")}finally{E(!1)}},[I,D]);(0,s.useEffect)(()=>{O()},[O]);const q=()=>{O()};if(U)return(0,_.jsx)("div",{className:"d-flex justify-content-center py-5",children:(0,_.jsx)(i.A,{animation:"border"})});if(R)return(0,_.jsxs)(l.A,{className:"py-5",children:[(0,_.jsx)(o.A,{variant:"danger",children:R}),(0,_.jsx)(v.A,{})]});if(!T)return(0,_.jsxs)(l.A,{className:"py-5",children:[(0,_.jsx)(o.A,{variant:"warning",children:"Pasto non trovato"}),(0,_.jsx)(v.A,{})]});const Q=L&&((null===(e=T.host)||void 0===e?void 0:e._id)===L._id||T.host===L._id),Z=L&&(null===(a=T.participants)||void 0===a?void 0:a.some(e=>(e._id||e)===L._id)),V="virtual"===T.mealType,W=(null===(t=T.participants)||void 0===t||t.length,T.maxParticipants,new Date(T.date)<new Date),G=new Date(T.date),J=new Date,X=60*(T.duration||60)*1e3,K=new Date(G.getTime()+X),Y=new Date(G.getTime()-6e5),$=V&&(Z||Q)&&J>=Y&&J<=K,ee=V&&(Z||Q)&&J<Y&&J>new Date(G.getTime()-864e5);return(0,_.jsxs)("div",{className:A.pageContainer,children:[(0,_.jsx)("div",{className:A.heroImage,style:{backgroundImage:"url(".concat((0,u.xW)(T.imageUrl),")")},children:(0,_.jsx)("div",{className:A.overlay,children:(0,_.jsxs)(l.A,{children:[(0,_.jsx)(v.A,{className:"mb-3 text-white"}),(0,_.jsx)(c.A,{bg:V?"info":"success",className:"mb-2",children:D(V?"meals.type.virtual":"meals.type.physical")}),(0,_.jsx)("h1",{className:A.title,children:T.title})]})})}),(0,_.jsx)(l.A,{className:A.contentContainer,children:(0,_.jsxs)(r.A,{children:[(0,_.jsxs)(d.A,{lg:8,children:[(0,_.jsxs)("div",{className:A.card,children:[(0,_.jsxs)("div",{className:A.hostInfo,children:[(0,_.jsx)("img",{src:(0,u.DP)(T.host),alt:null===(b=T.host)||void 0===b?void 0:b.nickname,className:A.hostAvatar}),(0,_.jsxs)("div",{children:[(0,_.jsx)("p",{className:"mb-0 text-muted",children:D("meals.detail.hostedBy")}),(0,_.jsx)("strong",{children:(null===(w=T.host)||void 0===w?void 0:w.nickname)||"Host"})]})]}),(0,_.jsxs)("div",{className:A.infoGrid,children:[(0,_.jsxs)("div",{className:A.infoItem,children:[(0,_.jsx)(x.bfZ,{className:A.icon}),(0,_.jsxs)("div",{children:[(0,_.jsx)("label",{children:D("meals.form.dateLabel")}),(0,_.jsx)("p",{children:new Date(T.date).toLocaleDateString()})]})]}),(0,_.jsxs)("div",{className:A.infoItem,children:[(0,_.jsx)(x.w_X,{className:A.icon}),(0,_.jsxs)("div",{children:[(0,_.jsx)("label",{children:D("meals.form.timeLabel")}),(0,_.jsx)("p",{children:new Date(T.date).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})]}),(0,_.jsxs)("div",{className:A.infoItem,children:[(0,_.jsx)(x.YXz,{className:A.icon}),(0,_.jsxs)("div",{children:[(0,_.jsx)("label",{children:D("meals.detail.participants")}),(0,_.jsxs)("p",{children:[(null===(k=T.participants)||void 0===k?void 0:k.length)||0," / ",T.maxParticipants]})]})]})]}),(0,_.jsx)("hr",{}),(0,_.jsx)("h3",{children:D("meals.form.descriptionLabel")}),(0,_.jsx)("p",{className:A.description,children:T.description}),T.topics&&T.topics.length>0&&(0,_.jsxs)("div",{className:"mb-4",children:[(0,_.jsx)("h5",{children:D("meals.form.topicsLabel")}),(0,_.jsx)("div",{className:A.topicsContainer,children:T.topics.map((e,a)=>(0,_.jsxs)(c.A,{bg:"light",text:"dark",className:"me-2 p-2 border",children:["#",e]},a))})]})]}),!V&&T.location&&T.location.coordinates&&(0,_.jsxs)("div",{className:A.card,children:[(0,_.jsxs)("h4",{className:"mb-3",children:[(0,_.jsx)(x.vq8,{className:"me-2"}),D("meals.detail.location")]}),(0,_.jsx)("p",{className:"text-muted",children:T.location.address}),(0,_.jsx)("div",{style:{height:"300px",borderRadius:"10px",overflow:"hidden"},children:(0,_.jsx)(f.A,{readOnly:!0,center:[T.location.coordinates[1],T.location.coordinates[0]],zoom:15,markers:[{lat:T.location.coordinates[1],lng:T.location.coordinates[0],title:T.title}]})}),(0,_.jsx)(m.A,{variant:"outline-primary",className:"mt-3 w-100",onClick:()=>window.open("https://www.google.com/maps/search/?api=1&query=".concat(T.location.coordinates[1],",").concat(T.location.coordinates[0]),"_blank"),children:"Apri in Google Maps \ud83d\uddfa\ufe0f"})]})]}),(0,_.jsx)(d.A,{lg:4,children:(0,_.jsxs)("div",{className:"".concat(A.card," ").concat(A.actionCard),children:[(0,_.jsx)("h4",{className:"mb-4",children:D("meals.detail.actions")}),!Q&&!Z&&!W&&(0,_.jsx)(N,{meal:T,onSuccess:q,className:"w-100 mb-3 btn-lg"}),!Q&&Z&&!W&&(0,_.jsx)(y.A,{mealId:T._id,onSuccess:q,className:"w-100 mb-3 btn-outline-danger"}),(Z||Q)&&T.chatId&&(0,_.jsxs)(m.A,{variant:"primary",className:"w-100 mb-3 d-flex align-items-center justify-content-center gap-2",onClick:()=>{if(T.chatId){const e="object"===typeof T.chatId?T.chatId._id:T.chatId;z("/chats/".concat(e))}else p.oR.error(D("chat.notAvailable")||"Chat non ancora disponibile")},children:[(0,_.jsx)(x.j1Q,{})," ",D("meals.detail.openChat")]}),$?(0,_.jsxs)(m.A,{variant:"success",className:"w-100 mb-3 d-flex align-items-center justify-content-center gap-2",onClick:()=>{z("/meals/".concat(T._id,"/video"))},children:[(0,_.jsx)(x.HiP,{})," ",D("meals.detail.joinVideo")]}):ee&&(0,_.jsxs)("div",{className:"w-100 mb-3 text-center text-muted small border p-2 rounded bg-light",children:[(0,_.jsx)(x.HiP,{className:"me-1"}),"Video disponibile dalle ",Y.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]}),(0,_.jsxs)(m.A,{variant:"outline-secondary",className:"w-100",onClick:()=>{navigator.share?navigator.share({title:T.title,text:"Unisciti a me per ".concat(T.title," su TableTalk!"),url:window.location.href}):(navigator.clipboard.writeText(window.location.href),p.oR.success("Link copiato negli appunti!"))},children:[(0,_.jsx)(x.eb3,{className:"me-2"})," ",D("common.share")]}),(0,_.jsxs)("div",{className:"mt-4",children:[(0,_.jsxs)("h5",{children:[D("meals.detail.participantsList")," (",(null===(C=T.participants)||void 0===C?void 0:C.length)||0,")"]}),(0,_.jsxs)("div",{className:A.avatarList,children:[(0,_.jsx)("div",{className:A.participantItem,title:"Host: ".concat(null===(P=T.host)||void 0===P?void 0:P.nickname),children:(0,_.jsx)("img",{src:(0,u.DP)(T.host),className:A.miniAvatar,style:{border:"2px solid #ff6b6b"},alt:"Host"})}),null===(M=T.participants)||void 0===M?void 0:M.map(e=>(e._id||e)!==(T.host._id||T.host)&&(0,_.jsx)("div",{className:A.participantItem,title:e.nickname,children:(0,_.jsx)("img",{src:(0,u.DP)(e),className:A.miniAvatar,alt:e.nickname||"User"})},e._id||e))]})]})]})})]})})]})}},4063:(e,a,t)=>{t.d(a,{A:()=>h});var s=t(2555),n=t(45),i=t(8139),l=t.n(i),o=t(5043),c=t(7852),r=t(579);const d=["bsPrefix","bg","pill","text","className","as"],m=o.forwardRef((e,a)=>{let{bsPrefix:t,bg:i="primary",pill:o=!1,text:m,className:h,as:p="span"}=e,x=(0,n.A)(e,d);const g=(0,c.oU)(t,"badge");return(0,r.jsx)(p,(0,s.A)((0,s.A)({ref:a},x),{},{className:l()(h,g,o&&"rounded-pill",m&&"text-".concat(m),i&&"bg-".concat(i))}))});m.displayName="Badge";const h=m},6229:(e,a,t)=>{t.d(a,{A:()=>o});t(5043);var s=t(9926),n=t(4282),i=t(7417),l=t(579);const o=e=>{let{mealId:a,onSuccess:t}=e;const{leaveMeal:o,loading:c}=(0,s.w)();return(0,l.jsx)(n.A,{variant:"outline-danger",className:"w-100",onClick:async()=>{if(window.confirm("Sei sicuro di voler abbandonare questo TableTalk\xae?"))try{const e=await o(a);t&&t(e)}catch(e){console.error("Fallimento leaveMeal nel componente:",e)}},disabled:c,children:c?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(i.A,{as:"span",animation:"border",size:"sm"}),(0,l.jsx)("span",{children:" Uscita in corso..."})]}):"Abbandona il TableTalk\xae"})}},7352:(e,a,t)=>{t.d(a,{A:()=>o});t(5043);var s=t(3216),n=t(184);const i="BackButton_backButton__hBNQM";var l=t(579);const o=e=>{let{className:a=""}=e;const t=(0,s.Zp)();return(0,l.jsxs)("button",{onClick:()=>{t(-1)},className:"".concat(i," ").concat(a),children:[(0,l.jsx)(n.QVr,{style:{marginRight:8}}),"Torna indietro"]})}},8602:(e,a,t)=>{t.d(a,{A:()=>p});var s=t(2555),n=t(45),i=t(8139),l=t.n(i),o=t(5043),c=t(7852),r=t(579);const d=["as","bsPrefix","className"],m=["className"];const h=o.forwardRef((e,a)=>{const[t,{as:i="div",bsPrefix:o,spans:h}]=function(e){let{as:a,bsPrefix:t,className:i}=e,o=(0,n.A)(e,d);t=(0,c.oU)(t,"col");const r=(0,c.gy)(),m=(0,c.Jm)(),h=[],p=[];return r.forEach(e=>{const a=o[e];let s,n,i;delete o[e],"object"===typeof a&&null!=a?({span:s,offset:n,order:i}=a):s=a;const l=e!==m?"-".concat(e):"";s&&h.push(!0===s?"".concat(t).concat(l):"".concat(t).concat(l,"-").concat(s)),null!=i&&p.push("order".concat(l,"-").concat(i)),null!=n&&p.push("offset".concat(l,"-").concat(n))}),[(0,s.A)((0,s.A)({},o),{},{className:l()(i,...h,...p)}),{as:a,bsPrefix:t,spans:h}]}(e),{className:p}=t,x=(0,n.A)(t,m);return(0,r.jsx)(i,(0,s.A)((0,s.A)({},x),{},{ref:a,className:l()(p,!h.length&&o)}))});h.displayName="Col";const p=h}}]);
//# sourceMappingURL=903.90c8b37f.chunk.js.map