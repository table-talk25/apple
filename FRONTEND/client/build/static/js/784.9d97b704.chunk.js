"use strict";(self.webpackChunktable_talk_client=self.webpackChunktable_talk_client||[]).push([[784],{549:(e,t,a)=>{a.d(t,{A:()=>h});var i=a(5043),n=a(9896),s=a(9419),o=a(6036),l=a(3318),r=a(2023),c=a(228),d=a.n(c),m=(a(6433),a(579));function p(e){let{position:t}=e;const a=(0,n.ko)();return(0,i.useEffect)(()=>{t&&a.setView([t.lat,t.lng],a.getZoom())},[t,a]),null}function u(e){let{onLocationSelect:t,onMapClick:a}=e;return(0,n.Po)({click(e){const{lat:i,lng:n}=e.latlng;a&&a(),t&&t({lat:i,lng:n})}}),null}delete d().Icon.Default.prototype._getIconUrl,d().Icon.Default.mergeOptions({iconRetinaUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon-2x.png",iconUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png"});const h=e=>{let{meals:t=[],markers:a=[],onLocationSelect:n,onMarkerClick:c,onMapClick:h,selectedLocation:g,userLocation:x=null,zoom:f=13,height:b="400px",width:y="100%",center:j=[45.4642,9.19]}=e;const[v,_]=(0,i.useState)(""),[A,N]=(0,i.useState)([]),[L,S]=(0,i.useState)(!1),T=async e=>{if(e&&!(e.length<3)){S(!0);try{const t=await fetch("https://nominatim.openstreetmap.org/search?format=json&q=".concat(encodeURIComponent(e),"&limit=5&countrycodes=it&addressdetails=1")),a=(await t.json()).map(e=>({id:e.place_id,name:e.display_name,lat:parseFloat(e.lat),lng:parseFloat(e.lon),address:e.display_name}));N(a)}catch(t){console.error("Errore ricerca luoghi:",t),N([])}finally{S(!1)}}};return(0,m.jsxs)("div",{style:{width:"100%"},children:[(0,m.jsxs)("div",{style:{marginBottom:"10px"},children:[(0,m.jsxs)("div",{style:{position:"relative"},children:[(0,m.jsx)("input",{type:"text",placeholder:"\ud83d\udd0d Cerca ristoranti, indirizzi...",value:v,onChange:e=>_(e.target.value),onKeyPress:e=>"Enter"===e.key&&T(v),style:{width:"100%",padding:"12px",border:"2px solid #ddd",borderRadius:"8px",fontSize:"16px"}}),(0,m.jsx)("button",{onClick:()=>T(v),disabled:L,style:{position:"absolute",right:"8px",top:"50%",transform:"translateY(-50%)",background:"#FF6B35",color:"white",border:"none",padding:"8px 12px",borderRadius:"6px",cursor:"pointer"},children:L?"...":"Cerca"})]}),A.length>0&&(0,m.jsx)("div",{style:{position:"absolute",zIndex:1e3,background:"white",border:"1px solid #ddd",borderRadius:"8px",marginTop:"5px",maxHeight:"200px",overflowY:"auto",width:"100%"},children:A.map(e=>(0,m.jsxs)("div",{onClick:()=>{n&&n({lat:e.lat,lng:e.lng,address:e.address}),N([]),_(e.name.split(",")[0])},style:{padding:"10px",cursor:"pointer",borderBottom:"1px solid #eee",fontSize:"14px"},onMouseEnter:e=>e.target.style.backgroundColor="#f5f5f5",onMouseLeave:e=>e.target.style.backgroundColor="white",children:["\ud83d\udccd ",e.name]},e.id))})]}),(0,m.jsxs)(s.W,{center:j,zoom:f,style:{height:b,width:y,borderRadius:"8px"},children:[(0,m.jsx)(r.e,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:'\xa9 <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}),(0,m.jsx)(u,{onLocationSelect:n,onMapClick:h}),g&&(0,m.jsx)(p,{position:g}),x&&(0,m.jsx)(o.p,{position:[x.lat,x.lng],icon:d().icon({iconUrl:"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-blue.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),children:(0,m.jsxs)(l.z,{children:["\ud83d\udccd ",(0,m.jsx)("strong",{children:"La tua posizione"})]})}),g&&(0,m.jsx)(o.p,{position:[g.lat,g.lng],children:(0,m.jsxs)(l.z,{children:["\ud83d\udccd ",(0,m.jsx)("strong",{children:"Posizione selezionata"}),(0,m.jsx)("br",{}),g.address||"".concat(g.lat.toFixed(4),", ").concat(g.lng.toFixed(4))]})}),a.map(e=>(0,m.jsx)(o.p,{position:[e.lat,e.lng],eventHandlers:{click:()=>{c&&c(e.id)}},children:(0,m.jsx)(l.z,{children:(0,m.jsxs)("div",{style:{minWidth:"200px"},children:[(0,m.jsxs)("h3",{style:{margin:"0 0 8px 0",color:"#FF6B35"},children:["\ud83c\udf7d\ufe0f ",e.title||e.name]}),e.price&&(0,m.jsxs)("p",{style:{margin:"4px 0"},children:["\ud83d\udcb0 \u20ac",e.price]}),e.type&&(0,m.jsxs)("p",{style:{margin:"4px 0",color:"#666"},children:["\ud83d\udcc5 ",e.type]})]})})},e.id)),t.map(e=>(0,m.jsx)(o.p,{position:[e.lat,e.lng],eventHandlers:{click:()=>{c&&c(e.id)}},children:(0,m.jsx)(l.z,{children:(0,m.jsxs)("div",{style:{minWidth:"200px"},children:[(0,m.jsxs)("h3",{style:{margin:"0 0 8px 0",color:"#FF6B35"},children:["\ud83c\udf7d\ufe0f ",e.name]}),(0,m.jsxs)("p",{style:{margin:"4px 0"},children:["\ud83d\udccd ",e.restaurant||e.address]}),(0,m.jsxs)("p",{style:{margin:"4px 0"},children:["\ud83d\udc65 ",e.participants||0," partecipanti"]}),(0,m.jsxs)("p",{style:{margin:"4px 0"},children:["\ud83d\udcc5 ",e.date]}),(0,m.jsx)("button",{onClick:()=>window.open("/meal/".concat(e.id),"_blank"),style:{background:"#FF6B35",color:"white",border:"none",padding:"8px 16px",borderRadius:"6px",cursor:"pointer",marginTop:"8px"},children:"Partecipa al TableTalk"})]})})},e.id))]})]})}},1072:(e,t,a)=>{a.d(t,{A:()=>p});var i=a(2555),n=a(45),s=a(8139),o=a.n(s),l=a(5043),r=a(7852),c=a(579);const d=["bsPrefix","className","as"],m=l.forwardRef((e,t)=>{let{bsPrefix:a,className:s,as:l="div"}=e,m=(0,n.A)(e,d);const p=(0,r.oU)(a,"row"),u=(0,r.gy)(),h=(0,r.Jm)(),g="".concat(p,"-cols"),x=[];return u.forEach(e=>{const t=m[e];let a;delete m[e],null!=t&&"object"===typeof t?({cols:a}=t):a=t;const i=e!==h?"-".concat(e):"";null!=a&&x.push("".concat(g).concat(i,"-").concat(a))}),(0,c.jsx)(l,(0,i.A)((0,i.A)({ref:t},m),{},{className:o()(s,p,...x)}))});m.displayName="Row";const p=m},7352:(e,t,a)=>{a.d(t,{A:()=>l});a(5043);var i=a(3216),n=a(184);const s="BackButton_backButton__hBNQM";var o=a(579);const l=e=>{let{className:t=""}=e;const a=(0,i.Zp)();return(0,o.jsxs)("button",{onClick:()=>{a(-1)},className:"".concat(s," ").concat(t),children:[(0,o.jsx)(n.QVr,{style:{marginRight:8}}),"Torna indietro"]})}},7777:(e,t,a)=>{a.d(t,{A:()=>L});var i=a(2555),n=a(5043),s=a(8298),o=a(1072),l=a(8602),r=a(4282),c=a(7417),d=a(4117),m=a(5950);const p={form:"MealForm_form__iyuod",formGroup:"MealForm_formGroup__Nagwi",formLabel:"MealForm_formLabel__EuahF",formControl:"MealForm_formControl__QOV2v",dateInputContainer:"MealForm_dateInputContainer__tCElf",dateHelperButton:"MealForm_dateHelperButton__ypazG",formSelect:"MealForm_formSelect__qfqPi",formCheck:"MealForm_formCheck__GCWf7",typeSelector:"MealForm_typeSelector__mfJc5",typeButton:"MealForm_typeButton__KyHCF",active:"MealForm_active__Hpn7f",typeIcon:"MealForm_typeIcon__XJPIu",typeText:"MealForm_typeText__7CnAo",typeDescription:"MealForm_typeDescription__t2zNS",typeInfo:"MealForm_typeInfo__pB1+E",visibilitySelector:"MealForm_visibilitySelector__WKtUp",visibilityButton:"MealForm_visibilityButton__D2Hp1",visibilityIcon:"MealForm_visibilityIcon__FlV5b",visibilityText:"MealForm_visibilityText__dnQrt",visibilityDescription:"MealForm_visibilityDescription__FL8e4",visibilityInfo:"MealForm_visibilityInfo__-fbWG",mapContainer:"MealForm_mapContainer__whBqK",locationInfo:"MealForm_locationInfo__hHdUX",submitButton:"MealForm_submitButton__fUBD0",stickyActions:"MealForm_stickyActions__wBnhW",cancelButton:"MealForm_cancelButton__thg-a",error:"MealForm_error__TbffJ",success:"MealForm_success__pUq4n",loading:"MealForm_loading__6DqYq"},u="TopicInput_topicInputContainer__NfIJd",h="TopicInput_topicTag__HTw1U",g="TopicInput_removeTagButton__sDCPm",x="TopicInput_topicInput__WbbZc",f="TopicInput_inputError__VAq+v",b="TopicInput_hasError__0Xkbf",y="TopicInput_errorMessage__leuM0";var j=a(579);const v=e=>{let{topics:t,setTopics:a,onValidationChange:i}=e;const[s,o]=(0,n.useState)(""),[l,r]=(0,n.useState)("");(0,n.useEffect)(()=>{c()},[]),(0,n.useEffect)(()=>{if(i){const e=t.length>0&&t.every(e=>{const t=e.trim();return t.length>=2&&t.length<=50&&!/^\s+$/.test(t)});i(e)}},[t,i]);const c=()=>{if(!Array.isArray(t)||0===t.length)return;const e=t.filter(e=>{if("string"!==typeof e)return!1;const t=e.trim();return t.length>=2&&t.length<=50&&!/^\s+$/.test(t)&&!/^[^\w\s]+$/.test(t)&&/^[\w\s\u00C0-\u017F]+$/i.test(t)});e.length!==t.length&&(console.log("\ud83e\uddf9 [TopicInput] Puliti ".concat(t.length-e.length," argomenti non validi")),a(e))};return(0,j.jsxs)("div",{className:"".concat(u," ").concat(l?b:""),children:[t.map((e,i)=>(0,j.jsxs)("div",{className:h,children:[e,(0,j.jsx)("button",{type:"button",className:g,onClick:()=>{return i=e,void a(t.filter(e=>e!==i));var i},children:"\xd7"})]},i)),(0,j.jsx)("input",{type:"text",value:s,onChange:e=>{o(e.target.value),l&&r("")},onKeyDown:e=>{if("Enter"===e.key||","===e.key){e.preventDefault();const i=(e=>{if("string"!==typeof e)return{isValid:!1,error:"L'argomento deve essere una stringa valida"};const a=e.trim();return a.length<2?{isValid:!1,error:"L'argomento deve essere di almeno 2 caratteri"}:a.length>50?{isValid:!1,error:"L'argomento non pu\xf2 superare i 50 caratteri"}:t.some(e=>e.toLowerCase()===a.toLowerCase())?{isValid:!1,error:"Questo argomento \xe8 gi\xe0 presente"}:/^\s+$/.test(a)?{isValid:!1,error:"L'argomento non pu\xf2 contenere solo spazi"}:/^[\w\s\u00C0-\u017F]+$/i.test(a)?{isValid:!0,topic:a}:{isValid:!1,error:"L'argomento pu\xf2 contenere solo lettere, numeri e spazi"}})(s);if(i.isValid)if(t.length<5)a([...t,i.topic]),o(""),r("");else{const e="Limite massimo di 5 argomenti raggiunto";console.warn("\u26a0\ufe0f [TopicInput] ".concat(e)),r(e)}else console.warn("\u26a0\ufe0f [TopicInput] Argomento non valido: ".concat(i.error)),r(i.error)}},placeholder:t.length<5?"Aggiungi un argomento...":"Massimo 5 argomenti",className:"".concat(x," ").concat(l?f:""),disabled:t.length>=5}),l&&(0,j.jsxs)("div",{className:y,children:["\u26a0\ufe0f ",l]})]})};var _=a(549),A=a(8993);const N=["Italiano","English","Espa\xf1ol","Fran\xe7ais","Deutsch","\u4e2d\u6587","\u0627\u0644\u0639\u0631\u0628\u064a\u0629"],L=e=>{var t;let{initialData:a,onSubmit:u,onCancel:h,isLoading:g,isSubmitting:x,submitButtonText:f}=e;const{t:b}=(0,d.Bd)(),y=[{value:30,label:b("meals.form.durationOptions.30min")},{value:60,label:b("meals.form.durationOptions.1hour")},{value:90,label:b("meals.form.durationOptions.1hour30")},{value:120,label:b("meals.form.durationOptions.2hours")},{value:150,label:b("meals.form.durationOptions.2hours30")},{value:180,label:b("meals.form.durationOptions.3hours")}],[L,S]=(0,n.useState)((()=>{const e=new Date,t=new Date(e.getTime()+36e5),a=t.getFullYear(),i=String(t.getMonth()+1).padStart(2,"0"),n=String(t.getDate()).padStart(2,"0"),s=String(t.getHours()).padStart(2,"0"),o=String(t.getMinutes()).padStart(2,"0");return{title:"",description:"",mealType:"virtual",type:"lunch",date:"".concat(a,"-").concat(i,"-").concat(n,"T").concat(s,":").concat(o),duration:60,maxParticipants:2,language:"English",topics:[],location:null,isPublic:!0,estimatedCost:""}})()),[T,C]=(0,n.useState)(null),[w,M]=(0,n.useState)(null),[F,k]=(0,n.useState)(""),[D,I]=(0,n.useState)({}),[z,E]=(0,n.useState)(null);(0,n.useEffect)(()=>{L.location&&L.location.coordinates&&E({lat:L.location.coordinates[1],lng:L.location.coordinates[0],address:L.location.address})},[L.location]);const B=(e,t)=>{switch(e){case"title":if(!t.trim())return b("meals.form.titleRequired");if(t.trim().length<5)return b("meals.form.titleMinLength");if(t.trim().length>50)return b("meals.form.titleMaxLength");if((0,A.$J)(t))return"Il titolo contiene contenuto non permesso (HTML/JavaScript)";break;case"description":if(!t.trim())return b("meals.form.descriptionRequired");if(t.trim().length<10)return b("meals.form.descriptionMinLength");if(t.trim().length>1e3)return b("meals.form.descriptionMaxLength");if((0,A.$J)(t))return"La descrizione contiene contenuto non permesso (HTML/JavaScript)";break;case"date":if(!t)return b("meals.form.dateRequired");const e=new Date(t),a=new Date,i=3e5;if(e<new Date(a.getTime()-i))return b("meals.form.datePast")||"La data deve essere nel futuro";if(e>new Date(a.getFullYear()+1,a.getMonth(),a.getDate()))return b("meals.form.dateTooFar")||"La data non pu\xf2 essere pi\xf9 di un anno nel futuro";break;case"maxParticipants":if(!t||t<2)return b("meals.form.maxParticipantsMin");if(t>10)return b("meals.form.maxParticipantsMax");break;case"topics":default:return"";case"location":if("physical"===L.mealType&&!t)return b("meals.form.locationRequired")}return""},P=e=>{const{name:t,value:a}=e.target;if("date"===t&&a){const e=new Date(a),t=new Date,n=3e5;if(e<new Date(t.getTime()-n))return console.warn("\u26a0\ufe0f [MealForm] Data nel passato selezionata, reset campo"),S(e=>(0,i.A)((0,i.A)({},e),{},{date:""})),void I(e=>(0,i.A)((0,i.A)({},e),{},{date:b("meals.form.datePast")||"La data deve essere nel futuro"}))}S(e=>(0,i.A)((0,i.A)({},e),{},{[t]:a}));const n=B(t,a);I(e=>(0,i.A)((0,i.A)({},e),{},{[t]:n}))},R=e=>{const{name:t,value:a}=e.target,n=B(t,a);I(e=>(0,i.A)((0,i.A)({},e),{},{[t]:n}))},O=async function(e){let{maxWidth:t=1600,quality:a=.7}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{const i=await createImageBitmap(e),n=Math.min(1,t/i.width),s=Math.round(i.width*n),o=Math.round(i.height*n),l=document.createElement("canvas");l.width=s,l.height=o;l.getContext("2d").drawImage(i,0,0,s,o);const r=l.toDataURL("image/jpeg",a),c=await fetch(r);return await c.blob()}catch(i){return e}},U=e=>new Promise((t,a)=>{try{const i=new FileReader;i.onloadend=()=>t(i.result),i.onerror=a,i.readAsDataURL(e)}catch(i){a(i)}});return(0,j.jsxs)(s.A,{onSubmit:e=>{if(e.preventDefault(),L.date){const e=new Date(L.date),t=new Date,a=3e5;if(e<new Date(t.getTime()-a))return console.warn("\u26a0\ufe0f [MealForm] Submit bloccato: data nel passato rilevata"),void I(e=>(0,i.A)((0,i.A)({},e),{},{date:b("meals.form.datePast")||"La data deve essere nel futuro"}))}const t={};if(Object.keys(L).forEach(e=>{const a=B(e,L[e]);a&&(t[e]=a)}),Object.keys(t).length>0)return void I(t);const a=(0,A.nB)(L);const n=new FormData,s=(0,i.A)({},a);s.date&&(s.date=new Date(s.date).toISOString());for(const i in s)"topics"===i&&Array.isArray(s[i])?s[i].forEach(e=>n.append("topics",e)):"location"===i&&s[i]?n.append("location",JSON.stringify(s[i])):"location"===i&&"physical"!==L.mealType||n.append(i,s[i]);T&&(n.append("image",T),F&&n.append("imageBase64",F),w&&n.append("imageLocalUri",w)),u(n)},className:p.form,children:[(0,j.jsxs)("div",{className:p.formGroup,children:[(0,j.jsx)("label",{className:p.formLabel,children:b("meals.form.typeLabel")}),(0,j.jsxs)("div",{className:p.typeSelector,children:[(0,j.jsxs)("button",{type:"button",className:"".concat(p.typeButton," ").concat("virtual"===L.mealType?p.active:""),onClick:()=>S((0,i.A)((0,i.A)({},L),{},{mealType:"virtual",location:null})),children:[(0,j.jsx)("span",{className:p.typeIcon,children:"\ud83c\udfa5"}),(0,j.jsx)("span",{className:p.typeText,children:b("meals.form.virtualType")}),(0,j.jsx)("small",{className:p.typeDescription,children:b("meals.form.virtualDescription")})]}),(0,j.jsxs)("button",{type:"button",className:"".concat(p.typeButton," ").concat("physical"===L.mealType?p.active:""),onClick:()=>S((0,i.A)((0,i.A)({},L),{},{mealType:"physical"})),children:[(0,j.jsx)("span",{className:p.typeIcon,children:"\ud83d\udccd"}),(0,j.jsx)("span",{className:p.typeText,children:b("meals.form.physicalType")}),(0,j.jsx)("small",{className:p.typeDescription,children:b("meals.form.physicalDescription")})]})]}),(0,j.jsx)("div",{className:p.typeInfo,children:"virtual"===L.mealType?b("meals.form.virtualInfo"):b("meals.form.physicalInfo")})]}),"physical"===L.mealType&&(0,j.jsxs)("div",{className:p.formGroup,children:[(0,j.jsx)("label",{className:p.formLabel,children:b("meals.form.visibilityLabel")}),(0,j.jsxs)("div",{className:p.visibilitySelector,children:[(0,j.jsxs)("button",{type:"button",className:"".concat(p.visibilityButton," ").concat(L.isPublic?p.active:""),onClick:()=>S((0,i.A)((0,i.A)({},L),{},{isPublic:!0})),children:[(0,j.jsx)("span",{className:p.visibilityIcon,children:"\ud83c\udf0d"}),(0,j.jsx)("span",{className:p.visibilityText,children:b("meals.form.publicVisibility")}),(0,j.jsx)("small",{className:p.visibilityDescription,children:b("meals.form.publicDescription")})]}),(0,j.jsxs)("button",{type:"button",className:"".concat(p.visibilityButton," ").concat(L.isPublic?"":p.active),onClick:()=>S((0,i.A)((0,i.A)({},L),{},{isPublic:!1})),children:[(0,j.jsx)("span",{className:p.visibilityIcon,children:"\ud83d\udd12"}),(0,j.jsx)("span",{className:p.visibilityText,children:b("meals.form.privateVisibility")}),(0,j.jsx)("small",{className:p.visibilityDescription,children:b("meals.form.privateDescription")})]})]}),(0,j.jsx)("div",{className:p.visibilityInfo,children:L.isPublic?b("meals.form.publicInfo"):b("meals.form.privateInfo")})]}),(0,j.jsxs)(s.A.Group,{className:"mb-3",children:[(0,j.jsx)(s.A.Label,{className:p.formLabel,children:b("meals.form.titleLabel")}),(0,j.jsx)(s.A.Control,{className:"".concat(p.formControl," ").concat(D.title?"is-invalid":""),type:"text",name:"title",value:L.title,onChange:P,onBlur:R,required:!0}),D.title&&(0,j.jsx)("div",{className:"invalid-feedback",children:D.title})]}),(0,j.jsxs)(s.A.Group,{className:"mb-3",children:[(0,j.jsx)(s.A.Label,{className:p.formLabel,children:b("meals.form.descriptionLabel")}),(0,j.jsx)(s.A.Control,{className:"".concat(p.formControl," ").concat(D.description?"is-invalid":""),as:"textarea",rows:3,name:"description",value:L.description,onChange:P,onBlur:R,required:!0}),D.description&&(0,j.jsx)("div",{className:"invalid-feedback",children:D.description})]}),(0,j.jsxs)(o.A,{className:"mb-3",children:[(0,j.jsx)(l.A,{md:6,children:(0,j.jsxs)(s.A.Group,{children:[(0,j.jsx)(s.A.Label,{className:p.formLabel,children:b("meals.form.categoryLabel")}),(0,j.jsxs)(s.A.Select,{className:p.formSelect,name:"type",value:L.type,onChange:P,required:!0,children:[(0,j.jsx)("option",{value:"",disabled:!0,children:b("meals.form.selectCategory")}),m.oD.map(e=>(0,j.jsx)("option",{value:e.value,children:e.label},e.value))]})]})}),(0,j.jsx)(l.A,{md:6,children:(0,j.jsxs)(s.A.Group,{children:[(0,j.jsx)(s.A.Label,{className:p.formLabel,children:b("meals.form.maxParticipantsLabel")}),(0,j.jsx)(s.A.Control,{className:"".concat(p.formControl," ").concat(D.maxParticipants?"is-invalid":""),type:"number",name:"maxParticipants",value:L.maxParticipants,onChange:P,onBlur:R,required:!0,min:"2",max:"10"}),D.maxParticipants&&(0,j.jsx)("div",{className:"invalid-feedback",children:D.maxParticipants})]})})]}),(0,j.jsxs)(o.A,{className:"mb-3",children:[(0,j.jsx)(l.A,{xs:12,md:6,children:(0,j.jsxs)(s.A.Group,{children:[(0,j.jsx)(s.A.Label,{className:p.formLabel,children:b("meals.form.languageLabel")}),(0,j.jsx)(s.A.Select,{className:p.formSelect,name:"language",value:L.language,onChange:P,required:!0,children:N.map(e=>(0,j.jsx)("option",{value:e,children:e},e))})]})}),(0,j.jsx)(l.A,{xs:12,md:6,children:(0,j.jsxs)(s.A.Group,{children:[(0,j.jsx)(s.A.Label,{className:p.formLabel,children:b("meals.form.durationLabel")}),(0,j.jsx)(s.A.Select,{className:p.formSelect,name:"duration",value:L.duration,onChange:P,required:!0,children:y.map(e=>(0,j.jsx)("option",{value:e.value,children:e.label},e.value))})]})})]}),"physical"===L.mealType&&(0,j.jsx)(o.A,{className:"mb-3",children:(0,j.jsx)(l.A,{md:6,children:(0,j.jsxs)(s.A.Group,{children:[(0,j.jsx)(s.A.Label,{className:p.formLabel,children:b("meals.form.priceLabel")||"Prezzo Stimato (\u20ac)"}),(0,j.jsxs)("div",{className:"input-group",children:[(0,j.jsx)("span",{className:"input-group-text",children:"\u20ac"}),(0,j.jsx)(s.A.Control,{className:p.formControl,type:"number",name:"estimatedCost",value:L.estimatedCost,onChange:P,placeholder:"Es. 25",min:"0"})]}),(0,j.jsx)(s.A.Text,{className:"text-muted",children:"Costo medio a persona (solo indicativo)"})]})})}),(0,j.jsxs)(o.A,{className:"mb-3",children:[(0,j.jsx)(l.A,{xs:12,md:6,children:(0,j.jsxs)(s.A.Group,{children:[(0,j.jsx)(s.A.Label,{className:p.formLabel,children:b("meals.form.dateLabel")}),(0,j.jsxs)("div",{className:p.dateInputContainer,children:[(0,j.jsx)(s.A.Control,{className:"".concat(p.formControl," ").concat(D.date?"is-invalid":""),type:"datetime-local",name:"date",value:L.date,min:(()=>{const e=new Date,t=new Date(e.getTime()-3e5),a=t.getFullYear(),i=String(t.getMonth()+1).padStart(2,"0"),n=String(t.getDate()).padStart(2,"0"),s=String(t.getHours()).padStart(2,"0"),o=String(t.getMinutes()).padStart(2,"0");return"".concat(a,"-").concat(i,"-").concat(n,"T").concat(s,":").concat(o)})(),onChange:P,onBlur:R,required:!0}),(0,j.jsx)("button",{type:"button",className:p.dateHelperButton,onClick:()=>{const e=new Date,t=new Date(e.getTime()+36e5),a=t.getFullYear(),n=String(t.getMonth()+1).padStart(2,"0"),s=String(t.getDate()).padStart(2,"0"),o=String(t.getHours()).padStart(2,"0"),l=String(t.getMinutes()).padStart(2,"0"),r="".concat(a,"-").concat(n,"-").concat(s,"T").concat(o,":").concat(l);S(e=>(0,i.A)((0,i.A)({},e),{},{date:r})),I(e=>(0,i.A)((0,i.A)({},e),{},{date:""}))},title:"Suggerisci data valida (1 ora da ora)",children:"\ud83d\udd50"})]}),D.date&&(0,j.jsx)("div",{className:"invalid-feedback",children:D.date}),(0,j.jsx)(s.A.Text,{className:"text-muted",children:"\ud83d\udcc5 Seleziona una data e ora nel futuro"})]})}),(0,j.jsx)(l.A,{xs:12,md:6,children:"physical"===L.mealType&&(0,j.jsxs)(s.A.Group,{children:[(0,j.jsx)(s.A.Label,{className:p.formLabel,children:b("meals.form.addressLabel")}),(0,j.jsx)(s.A.Control,{className:"".concat(p.formControl," ").concat(D.location?"is-invalid":""),type:"text",name:"location",value:(null===(t=L.location)||void 0===t?void 0:t.address)||"",onChange:P,onBlur:R,placeholder:b("meals.form.addressPlaceholder"),readOnly:!0}),D.location&&(0,j.jsx)("div",{className:"invalid-feedback",children:D.location}),(0,j.jsx)(s.A.Text,{className:"text-muted",children:"\ud83d\udccd L'indirizzo viene selezionato dalla mappa sottostante"})]})})]}),"physical"===L.mealType&&(0,j.jsxs)("div",{className:p.formGroup,children:[(0,j.jsx)("label",{children:"\ud83d\udccd Seleziona posizione del pasto:"}),(0,j.jsx)(_.A,{selectedLocation:z,onLocationSelect:e=>{E(e),S(t=>(0,i.A)((0,i.A)({},t),{},{location:{address:e.address||"".concat(e.lat.toFixed(4),", ").concat(e.lng.toFixed(4)),coordinates:[e.lng,e.lat]}})),I(e=>(0,i.A)((0,i.A)({},e),{},{location:null}))},height:"300px",center:z?[z.lat,z.lng]:L.location&&L.location.coordinates?[L.location.coordinates[1],L.location.coordinates[0]]:[45.4642,9.19]}),z&&(0,j.jsxs)("div",{className:"selected-location-info",style:{marginTop:"10px",padding:"10px",backgroundColor:"#f8f9fa",borderRadius:"8px",border:"1px solid #dee2e6"},children:["\u2705 ",(0,j.jsx)("strong",{children:"Posizione selezionata:"}),(0,j.jsx)("br",{}),(0,j.jsx)("span",{style:{fontSize:"14px",color:"#666"},children:z.address||"Lat: ".concat(z.lat.toFixed(4),", Lng: ").concat(z.lng.toFixed(4))})]})]}),(0,j.jsxs)(s.A.Group,{className:"mb-3",children:[(0,j.jsx)(s.A.Label,{className:p.formLabel,children:b("meals.form.topicsLabel")}),(0,j.jsx)(v,{topics:L.topics,setTopics:e=>{S(t=>(0,i.A)((0,i.A)({},t),{},{topics:e}));const t=B("topics",e);I(e=>(0,i.A)((0,i.A)({},e),{},{topics:t}))}}),D.topics&&(0,j.jsx)("div",{className:"invalid-feedback d-block",children:D.topics}),(0,j.jsx)(s.A.Text,{children:b("meals.form.topicsHelp")})]}),(0,j.jsxs)(s.A.Group,{className:"mb-3",children:[(0,j.jsx)(s.A.Label,{children:b("meals.form.coverImageLabel")}),w&&(0,j.jsx)("img",{src:w,alt:b("meals.form.coverImageAlt"),className:p.imagePreview}),(0,j.jsx)(s.A.Control,{type:"file",accept:"image/*",onChange:async e=>{const t=e.target.files[0];if(t)if(t.type.startsWith("image/"))if(t.size>10485760)alert("Il file \xe8 troppo grande. Massimo 10MB.");else try{const e=new FileReader;e.onload=e=>{M(e.target.result)},e.readAsDataURL(t);let i=t;if(t.size>4194304){const e=await O(t,{maxWidth:1600,quality:.7});i=new File([e],t.name,{type:"image/jpeg"})}C(i);try{const e=await U(i);"string"===typeof e&&k(e)}catch(a){}console.log("\ud83d\udcc1 File selezionato:",i.name,i.size)}catch(i){console.error("Errore elaborazione file",i)}else alert("Seleziona solo file immagine")},className:"mt-2",style:{fontSize:"0.9em"}}),(0,j.jsx)(s.A.Text,{className:"text-muted",children:"Seleziona un'immagine dal tuo dispositivo (max 10MB)"}),T&&(0,j.jsxs)("div",{className:"mt-2 p-2 bg-light rounded",style:{fontSize:"0.9em"},children:[(0,j.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,j.jsx)("span",{children:"\ud83d\udcf7 Immagine selezionata"}),(0,j.jsxs)("small",{className:"text-muted",children:[T.name," (",(T.size/1024/1024).toFixed(2)," MB)"]})]}),(0,j.jsx)("small",{className:"text-muted d-block mt-1",children:"L'immagine verr\xe0 caricata insieme al pasto"})]})]}),(0,j.jsx)("div",{className:p.stickyActions,children:(0,j.jsx)(r.A,{variant:"primary",type:"submit",className:p.submitButton,disabled:g||x,children:g||x?(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(c.A,{as:"span",animation:"border",size:"sm"}),(0,j.jsxs)("span",{children:[" ",b(x?"meals.form.saving":"meals.form.loading")]})]}):f||b("forms.save")})})]})}},8993:(e,t,a)=>{a.d(t,{$J:()=>r,nB:()=>c});var i=a(2555),n=a(7977);const s={ALLOWED_TAGS:[],ALLOWED_ATTR:[],ALLOW_DATA_ATTR:!1,ALLOW_UNKNOWN_PROTOCOLS:!1,RETURN_DOM:!1,RETURN_DOM_FRAGMENT:!1,RETURN_TRUSTED_TYPE:!1,KEEP_CONTENT:!1,IN_PLACE:!1,SANITIZE_DOM:!0,WHOLE_DOCUMENT:!1,RETURN_DOM_IMPORT:!1,FORCE_BODY:!1,SANITIZE_NAMED_PROPS:!1,ALLOWED_URI_REGEXP:/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i},o=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e||"string"!==typeof e)return"";try{const a=t?(0,i.A)((0,i.A)({},s),{},{ALLOWED_TAGS:["b","i","em","strong","u"],ALLOWED_ATTR:[]}):s;return n.A.sanitize(e,a)}catch(a){return console.error("\u274c [SanitizationService] Errore sanitizzazione:",a),""}},l=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!e||"object"!==typeof e)return e;const n=(0,i.A)({},e);return(t.length>0?t:Object.keys(e).filter(t=>"string"===typeof e[t])).forEach(e=>{n[e]&&"string"===typeof n[e]&&(n[e]=o(n[e],a))}),n},r=e=>{if(!e||"string"!==typeof e)return!1;return[/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,/<iframe\b[^<]*(?:(?!<\/iframe>)<[^<]*)*<\/iframe>/gi,/<object\b[^<]*(?:(?!<\/object>)<[^<]*)*<\/object>/gi,/<embed\b[^<]*(?:(?!<\/embed>)<[^<]*)*<\/embed>/gi,/javascript:/gi,/vbscript:/gi,/data:/gi,/on\w+\s*=/gi,/<.*>/g].some(t=>t.test(e))},c=e=>l(e,["title","description","language","topics"],!1)}}]);
//# sourceMappingURL=784.9d97b704.chunk.js.map