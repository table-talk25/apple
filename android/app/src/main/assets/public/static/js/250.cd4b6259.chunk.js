/*! For license information please see 250.cd4b6259.chunk.js.LICENSE.txt */
(self.webpackChunktable_talk_client=self.webpackChunktable_talk_client||[]).push([[250],{549:(e,a,t)=>{"use strict";t.d(a,{A:()=>g});var n=t(5043),s=t(9896),o=t(9419),l=t(6036),r=t(3318),i=t(2023),c=t(228),d=t.n(c),p=(t(6433),t(579));function m(e){let{position:a,zoom:t}=e;const o=(0,s.ko)();return(0,n.useEffect)(()=>{if(a&&a.lat&&a.lng){const e=t||o.getZoom();o.flyTo([a.lat,a.lng],e,{duration:1.5})}},[null===a||void 0===a?void 0:a.lat,null===a||void 0===a?void 0:a.lng,t,o]),null}function u(e){let{center:a,zoom:t}=e;const o=(0,s.ko)();return(0,n.useEffect)(()=>{if(a&&Array.isArray(a)&&2===a.length){const[e,n]=a,s=t||o.getZoom();o.flyTo([e,n],s,{duration:1.5})}},[a,t,o]),null}function h(e){let{onLocationSelect:a,onMapClick:t}=e;return(0,s.Po)({click(e){const{lat:n,lng:s}=e.latlng;t&&t(),a&&a({lat:n,lng:s})}}),null}delete d().Icon.Default.prototype._getIconUrl,d().Icon.Default.mergeOptions({iconRetinaUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon-2x.png",iconUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png"});const g=e=>{let{meals:a=[],markers:t=[],onLocationSelect:s,onMarkerClick:c,onMapClick:g,selectedLocation:x,userLocation:_=null,zoom:j=13,height:f="400px",width:v="100%",center:b=[45.4642,9.19]}=e;return(0,n.useEffect)(()=>{"undefined"===typeof window||window.L?console.log("\u2705 [Map] Leaflet caricato correttamente"):console.error("\u274c [Map] Leaflet non \xe8 disponibile")},[]),(0,p.jsx)("div",{style:{width:"100%",height:"100%",position:"relative"},children:(0,p.jsxs)(o.W,{center:b,zoom:j,style:{height:f,width:v,borderRadius:"8px"},whenReady:()=>{console.log("\u2705 [Map] Mappa Leaflet pronta")},whenCreated:e=>{console.log("\u2705 [Map] Istanza mappa creata")},children:[(0,p.jsx)(i.e,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:'\xa9 <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',errorTileUrl:"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='256' height='256'%3E%3Crect fill='%23ddd' width='256' height='256'/%3E%3Ctext fill='%23999' font-family='sans-serif' font-size='18' x='50%25' y='50%25' text-anchor='middle' dominant-baseline='middle'%3EErrore caricamento mappa%3C/text%3E%3C/svg%3E"}),(0,p.jsx)(u,{center:b,zoom:j}),(0,p.jsx)(h,{onLocationSelect:s,onMapClick:g}),x&&(0,p.jsx)(m,{position:x,zoom:j}),_&&(0,p.jsx)(l.p,{position:[_.lat,_.lng],icon:d().icon({iconUrl:"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-blue.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),children:(0,p.jsxs)(r.z,{children:["\ud83d\udccd ",(0,p.jsx)("strong",{children:"La tua posizione"})]})}),x&&(0,p.jsx)(l.p,{position:[x.lat,x.lng],children:(0,p.jsxs)(r.z,{children:["\ud83d\udccd ",(0,p.jsx)("strong",{children:"Posizione selezionata"}),(0,p.jsx)("br",{}),x.address||"".concat(x.lat.toFixed(4),", ").concat(x.lng.toFixed(4))]})}),t.map(e=>(0,p.jsx)(l.p,{position:[e.lat,e.lng],eventHandlers:{click:()=>{c&&c(e.id)}},children:(0,p.jsx)(r.z,{children:(0,p.jsxs)("div",{style:{minWidth:"200px"},children:[(0,p.jsxs)("h3",{style:{margin:"0 0 8px 0",color:"#FF6B35"},children:["\ud83c\udf7d\ufe0f ",e.title||e.name]}),e.price&&(0,p.jsxs)("p",{style:{margin:"4px 0"},children:["\ud83d\udcb0 \u20ac",e.price]}),e.type&&(0,p.jsxs)("p",{style:{margin:"4px 0",color:"#666"},children:["\ud83d\udcc5 ",e.type]})]})})},e.id)),a.map(e=>(0,p.jsx)(l.p,{position:[e.lat,e.lng],eventHandlers:{click:()=>{c&&c(e.id)}},children:(0,p.jsx)(r.z,{children:(0,p.jsxs)("div",{style:{minWidth:"200px"},children:[(0,p.jsxs)("h3",{style:{margin:"0 0 8px 0",color:"#FF6B35"},children:["\ud83c\udf7d\ufe0f ",e.name]}),(0,p.jsxs)("p",{style:{margin:"4px 0"},children:["\ud83d\udccd ",e.restaurant||e.address]}),(0,p.jsxs)("p",{style:{margin:"4px 0"},children:["\ud83d\udc65 ",e.participants||0," partecipanti"]}),(0,p.jsxs)("p",{style:{margin:"4px 0"},children:["\ud83d\udcc5 ",e.date]}),(0,p.jsx)("button",{onClick:()=>window.open("/meal/".concat(e.id),"_blank"),style:{background:"#FF6B35",color:"white",border:"none",padding:"8px 16px",borderRadius:"6px",cursor:"pointer",marginTop:"8px"},children:"Partecipa al TableTalk"})]})})},e.id))]})})}},2619:(e,a,t)=>{"use strict";t.d(a,{A:()=>z});t(5043);var n=t(5475),s=t(4117),o=t(184),l=t(5950),r=t(5016),i=t(4935);const c="EditMealButton_editButton__abQ9t";var d=t(579);const p=e=>{let{mealId:a}=e;return(0,d.jsx)(n.N_,{to:"/meals/edit/".concat(a),className:c,children:"Modifica TableTalk\xae"})};var m=t(6229);const u="MealCard_card__ZMpL4",h="MealCard_cardLink__NwoDy",g="MealCard_cardImageWrapper__o3OYh",x="MealCard_cardImageWrapperCompact__NsCVO",_="MealCard_cardImage__NfTS+",j="MealCard_cardImageType__mS24Y",f="MealCard_mealModeBadge__iRhot",v="MealCard_mealModeIcon__1sUXr",b="MealCard_mealModeText__iijFz",y="MealCard_cardTitle__IzHzc",C="MealCard_cardContent__xy66r",M="MealCard_cardDetail__++Z1c",N="MealCard_hostAvatar__SOgSA",k="MealCard_locationIcon__YwiGH",w="MealCard_locationText__4mI9I",A="MealCard_cardDescription__Meeix",T="MealCard_cardActions__apnlz",P="MealCard_actionButtons__m5ryk",I="MealCard_hostLink__HuRU-",z=e=>{var a;let{meal:t,onLeaveSuccess:c,compact:z=!1}=e;const{t:S}=(0,s.Bd)(),{user:R}=(0,r.A)(),{getMealTypeText:L,getMealModeText:B}=(0,i.j)();if(!t||!t.host)return console.error("MealCard ha ricevuto dati incompleti: ",t),null;const E=R&&R.id===t.host._id,F=R&&t.participants&&t.participants.some(e=>e._id===R.id),U=(0,l.xW)(t.imageUrl),D=(0,l.DP)(t.host.profileImage);console.log("\ud83d\udc64 [MealCard] Host ID:",t.host._id||t.host.id),console.log("\ud83d\udc64 [MealCard] Host object:",t.host);const q=t.description&&t.description.length>80?t.description.substring(0,80)+"...":t.description,H=new Date(new Date(t.date).getTime()+6e4*(t.duration||0)),O="completed"===t.status||"cancelled"===t.status||new Date>H;return(0,d.jsxs)("div",{className:u,children:[(0,d.jsxs)(n.N_,{to:"/meals/".concat(t._id),className:h,children:[(0,d.jsxs)("div",{className:z?x:g,children:[(0,d.jsx)("img",{src:U,alt:t.title,className:_}),(0,d.jsx)("div",{className:j,style:{backgroundColor:(0,l.hd)(t.type)},children:L(t.type)}),(0,d.jsxs)("div",{className:f,style:{backgroundColor:(0,l.wI)(t.mealType)},children:[(0,d.jsx)("span",{className:v,children:(0,l.Iy)(t.mealType)}),(0,d.jsx)("span",{className:b,children:B(t.mealType)})]})]}),(0,d.jsxs)("div",{className:C,children:[(0,d.jsx)("h3",{className:y,children:t.title}),(0,d.jsxs)("div",{className:M,children:[(0,d.jsx)(o.gqt,{}),(0,d.jsx)("span",{children:t.language})]}),(0,d.jsx)(n.N_,{to:"/public-profile/".concat(t.host._id||t.host.id),className:I,children:(0,d.jsxs)("div",{className:M,children:[(0,d.jsx)("img",{src:D,alt:t.host.nickname,className:N}),(0,d.jsxs)("span",{children:[S("meals.card.organizedBy")," ",(0,d.jsx)("strong",{children:t.host.nickname})]})]})}),(0,d.jsxs)("div",{className:M,children:[(0,d.jsx)(o.bfZ,{}),(0,d.jsx)("span",{children:(0,l.Yq)(t.date)})]}),!z&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)("div",{className:M,children:[(0,d.jsx)(o.w_X,{}),(0,d.jsxs)("span",{children:[S("meals.card.duration"),": ",t.duration," ",S("meals.card.minutes")]})]}),(0,d.jsxs)("div",{className:M,children:[(0,d.jsx)(o.w_X,{}),(0,d.jsxs)("span",{children:[S("meals.card.end"),": ",(0,l.Yq)(new Date(new Date(t.date).getTime()+6e4*t.duration),"HH:mm")]})]})]}),"physical"===t.mealType&&t.location&&(0,d.jsxs)("div",{className:M,children:[(0,d.jsx)("span",{className:k,children:"\ud83d\udccd"}),(0,d.jsx)("span",{className:w,children:t.location})]}),(0,d.jsx)("p",{className:A,children:q})]})]}),(0,d.jsxs)("div",{className:T,children:[(0,d.jsxs)("div",{className:M,children:[(0,d.jsx)(o.YXz,{}),(0,d.jsxs)("span",{children:[(null===(a=t.participants)||void 0===a?void 0:a.length)||0," / ",t.maxParticipants," ",S("meals.card.participants")]})]}),(0,d.jsxs)("div",{className:P,children:[!z&&E&&!O&&(0,d.jsx)(p,{mealId:t._id}),F&&!E&&!O&&(0,d.jsx)(m.A,{mealId:t._id,onSuccess:c})]})]})]})}},4140:(e,a,t)=>{"use strict";t.d(a,{Am:()=>l,Ay:()=>i});var n=t(5043),s=t(579);const o=["as","disabled"];function l(e){let{tagName:a,disabled:t,href:n,target:s,rel:o,role:l,onClick:r,tabIndex:i=0,type:c}=e;a||(a=null!=n||null!=s||null!=o?"a":"button");const d={tagName:a};if("button"===a)return[{type:c||"button",disabled:t},d];const p=e=>{(t||"a"===a&&function(e){return!e||"#"===e.trim()}(n))&&e.preventDefault(),t?e.stopPropagation():null==r||r(e)};return"a"===a&&(n||(n="#"),t&&(n=void 0)),[{role:null!=l?l:"button",disabled:void 0,tabIndex:t?void 0:i,href:n,target:"a"===a?s:void 0,"aria-disabled":t||void 0,rel:"a"===a?o:void 0,onClick:p,onKeyDown:e=>{" "===e.key&&(e.preventDefault(),p(e))}},d]}const r=n.forwardRef((e,a)=>{let{as:t,disabled:n}=e,r=function(e,a){if(null==e)return{};var t={};for(var n in e)if({}.hasOwnProperty.call(e,n)){if(a.indexOf(n)>=0)continue;t[n]=e[n]}return t}(e,o);const[i,{tagName:c}]=l(Object.assign({tagName:t,disabled:n},r));return(0,s.jsx)(c,Object.assign({},r,i,{ref:a}))});r.displayName="Button";const i=r},4250:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>T});var n=t(5043),s=t(4282),o=t(7417),l=t(3216),r=t(4117),i=t(184),c=t(3401),d=t(2179),p=t(549),m=t(2619),u=t(7352);const h="MapPage_mapPage__Q8CXY",g="MapPage_mapContainer__Q57lh",x="MapPage_topBar__pR8QC",_="MapPage_backButton__oXtTT",j="MapPage_searchContainer__y5w4w",f="MapPage_searchIcon__yq5yY",v="MapPage_searchInput__tAxxY",b="MapPage_searchButton__KggSC",y="MapPage_floatingControls__dH+sb",C="MapPage_fab__ZZ2pb",M="MapPage_mealPreviewContainer__N9PRk",N="MapPage_mealPreviewCard__5nAMT",k="MapPage_closePreview__ZOJrH",w="MapPage_listToggle__f5a4F";var A=t(579);const T=()=>{const{t:e}=(0,r.Bd)(),a=(0,l.Zp)(),[t,T]=(0,n.useState)([41.9028,12.4964]),[P,I]=(0,n.useState)(13),[z,S]=(0,n.useState)([]),[R,L]=(0,n.useState)(!1),[B,E]=(0,n.useState)(null),[F,U]=(0,n.useState)(null),[D,q]=(0,n.useState)(15),[H,O]=(0,n.useState)("");(0,n.useEffect)(()=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(e=>{const{latitude:a,longitude:t}=e.coords,n=[a,t];T(n),U(n),Y(a,t,D)},e=>{console.warn("Geolocalizzazione non disponibile o negata:",e),c.oR.info("Impossibile rilevare la posizione. Mostro Roma."),Y(41.9028,12.4964,D)}):Y(41.9028,12.4964,D)},[]);const Y=async(a,t,n)=>{try{L(!0);const e=await d.A.getMealsForMap({latitude:a,longitude:t},n,{mealType:"physical",status:"upcoming,ongoing"}),s=e.data||e;console.log("\ud83d\uddfa\ufe0f Trovati ".concat(s.length," pasti sulla mappa")),S(s)}catch(s){console.error("Errore mappa:",s),c.oR.error(e("map.loadError")||"Errore caricamento mappa")}finally{L(!1)}},Z=z.filter(e=>e.location&&e.location.coordinates).map(e=>({id:e._id,lat:e.location.coordinates[1],lng:e.location.coordinates[0],title:e.title,price:e.estimatedCost,type:e.type})),W=async e=>{if(e&&!(e.length<3))try{L(!0);const a=await fetch("https://nominatim.openstreetmap.org/search?format=json&q=".concat(encodeURIComponent(e),"&limit=1&countrycodes=it&addressdetails=1")),t=await a.json();if(t&&t.length>0){const e=t[0],a=[parseFloat(e.lat),parseFloat(e.lon)];T(a),I(14),Y(a[0],a[1],D),c.oR.success("Mappa centrata su ".concat(e.display_name))}else c.oR.warn("Luogo non trovato. Prova con un altro nome.")}catch(a){console.error("Errore ricerca luogo:",a),c.oR.error("Errore durante la ricerca del luogo")}finally{L(!1)}};return(0,A.jsxs)("div",{className:h,children:[(0,A.jsxs)("div",{className:x,children:[(0,A.jsx)(u.A,{className:_}),(0,A.jsxs)("div",{className:j,children:[(0,A.jsx)(i.KSO,{className:f}),(0,A.jsx)("input",{type:"text",placeholder:e("map.searchPlaceholder")||"Cerca citt\xe0 o zona...",className:v,value:H,onChange:e=>O(e.target.value),onKeyPress:e=>{"Enter"===e.key&&W(H)}}),(0,A.jsx)("button",{onClick:()=>W(H),disabled:R||!H.trim(),className:b,children:R?"...":"Cerca"})]})]}),(0,A.jsx)("div",{className:g,children:(0,A.jsx)(p.A,{center:t,zoom:P,markers:Z,onMarkerClick:e=>{const a=z.find(a=>a._id===e);a&&E(a)},onMapClick:()=>{B&&E(null)},onLocationSelect:e=>{if(e&&e.lat&&e.lng){const a=[e.lat,e.lng];T(a),I(14),Y(e.lat,e.lng,D)}},userLocation:F?{lat:F[0],lng:F[1]}:null,selectedLocation:t?{lat:t[0],lng:t[1]}:null,height:"100vh",width:"100%"})}),(0,A.jsxs)("div",{className:y,children:[(0,A.jsx)(s.A,{variant:"light",className:C,onClick:()=>{Y(t[0],t[1],D)},children:R?(0,A.jsx)(o.A,{size:"sm"}):"\ud83d\udd04 Cerca qui"}),(0,A.jsx)(s.A,{variant:"light",className:C,onClick:()=>{F?(T(F),I(14)):c.oR.warn("Posizione non disponibile")},children:(0,A.jsx)(i.meu,{color:"#007bff"})})]}),B&&(0,A.jsx)("div",{className:M,children:(0,A.jsxs)("div",{className:N,children:[(0,A.jsx)(m.A,{meal:B,compact:!0,onClick:()=>a("/meals/".concat(B._id))}),(0,A.jsx)("button",{className:k,onClick:()=>E(null),children:"\xd7"})]})}),(0,A.jsxs)(s.A,{className:w,onClick:()=>a("/meals"),children:[(0,A.jsx)(i.svy,{})," ",e("navigation.meals")||"Lista"]})]})}},4282:(e,a,t)=>{"use strict";t.d(a,{A:()=>u});var n=t(2555),s=t(45),o=t(8139),l=t.n(o),r=t(5043),i=t(4140),c=t(7852),d=t(579);const p=["as","bsPrefix","variant","size","active","disabled","className"],m=r.forwardRef((e,a)=>{let{as:t,bsPrefix:o,variant:r="primary",size:m,active:u=!1,disabled:h=!1,className:g}=e,x=(0,s.A)(e,p);const _=(0,c.oU)(o,"btn"),[j,{tagName:f}]=(0,i.Am)((0,n.A)({tagName:t,disabled:h},x)),v=f;return(0,d.jsx)(v,(0,n.A)((0,n.A)((0,n.A)({},j),x),{},{ref:a,disabled:h,className:l()(g,_,u&&"active",r&&"".concat(_,"-").concat(r),m&&"".concat(_,"-").concat(m),x.href&&h&&"disabled")}))});m.displayName="Button";const u=m},4935:(e,a,t)=>{"use strict";t.d(a,{j:()=>o});var n=t(4117),s=t(5950);const o=()=>{const{t:e}=(0,n.Bd)(),a=a=>{const t="meals.mealTypes.".concat(a);return e(t,a)},t=a=>{const t="meals.mealModes.".concat(a);return e(t,a)};return{getMealTypeText:a,getMealModeText:t,getMealStatusText:a=>{const t="meals.mealStatus.".concat(a);return e(t,a)},getMealTypeOptions:()=>[{value:s.q_.BREAKFAST,label:a(s.q_.BREAKFAST)},{value:s.q_.LUNCH,label:a(s.q_.LUNCH)},{value:s.q_.DINNER,label:a(s.q_.DINNER)},{value:s.q_.APERITIF,label:a(s.q_.APERITIF)}],getMealModeOptions:()=>[{value:s.x6.VIRTUAL,label:t(s.x6.VIRTUAL)},{value:s.x6.PHYSICAL,label:t(s.x6.PHYSICAL)}]}}},6229:(e,a,t)=>{"use strict";t.d(a,{A:()=>r});t(5043);var n=t(9926),s=t(4282),o=t(7417),l=t(579);const r=e=>{let{mealId:a,onSuccess:t}=e;const{leaveMeal:r,loading:i}=(0,n.w)();return(0,l.jsx)(s.A,{variant:"outline-danger",className:"w-100",onClick:async()=>{if(window.confirm("Sei sicuro di voler abbandonare questo TableTalk\xae?"))try{const e=await r(a);t&&t(e)}catch(e){console.error("Fallimento leaveMeal nel componente:",e)}},disabled:i,children:i?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(o.A,{as:"span",animation:"border",size:"sm"}),(0,l.jsx)("span",{children:" Uscita in corso..."})]}):"Abbandona il TableTalk\xae"})}},7352:(e,a,t)=>{"use strict";t.d(a,{A:()=>r});t(5043);var n=t(3216),s=t(184);const o="BackButton_backButton__hBNQM";var l=t(579);const r=e=>{let{className:a=""}=e;const t=(0,n.Zp)();return(0,l.jsxs)("button",{onClick:()=>{t(-1)},className:"".concat(o," ").concat(a),children:[(0,l.jsx)(s.QVr,{style:{marginRight:8}}),"Torna indietro"]})}},7852:(e,a,t)=>{"use strict";t.d(a,{Jm:()=>p,Wz:()=>m,gy:()=>d,oU:()=>c});var n=t(5043);t(579);const s=["xxl","xl","lg","md","sm","xs"],o="xs",l=n.createContext({prefixes:{},breakpoints:s,minBreakpoint:o}),{Consumer:r,Provider:i}=l;function c(e,a){const{prefixes:t}=(0,n.useContext)(l);return e||t[a]||a}function d(){const{breakpoints:e}=(0,n.useContext)(l);return e}function p(){const{minBreakpoint:e}=(0,n.useContext)(l);return e}function m(){const{dir:e}=(0,n.useContext)(l);return"rtl"===e}},8139:(e,a)=>{var t;!function(){"use strict";var n={}.hasOwnProperty;function s(){for(var e="",a=0;a<arguments.length;a++){var t=arguments[a];t&&(e=l(e,o(t)))}return e}function o(e){if("string"===typeof e||"number"===typeof e)return e;if("object"!==typeof e)return"";if(Array.isArray(e))return s.apply(null,e);if(e.toString!==Object.prototype.toString&&!e.toString.toString().includes("[native code]"))return e.toString();var a="";for(var t in e)n.call(e,t)&&e[t]&&(a=l(a,t));return a}function l(e,a){return a?e?e+" "+a:e+a:e}e.exports?(s.default=s,e.exports=s):void 0===(t=function(){return s}.apply(a,[]))||(e.exports=t)}()}}]);
//# sourceMappingURL=250.cd4b6259.chunk.js.map